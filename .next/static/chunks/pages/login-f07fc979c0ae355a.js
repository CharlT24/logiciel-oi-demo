(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3459],{6429:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(7644)}])},7644:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Login}});var n=r(5893),a=r(7294),s=r(1163),i=r(9846);function Login(){let[e,t]=(0,a.useState)(""),[r,l]=(0,a.useState)(""),[o,u]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),m=(0,s.useRouter)(),handleLogin=async t=>{t.preventDefault(),u(""),c(!0);let{data:n,error:a}=await i.O.auth.signInWithPassword({email:e,password:r});if(a){u("Email ou mot de passe incorrect."),c(!1);return}let s=n.user;if(!s){u("Utilisateur introuvable."),c(!1);return}let{data:l,error:o}=await i.O.from("utilisateurs").select("*").eq("id",s.id).single();if(o){var d,h;let{error:e}=await i.O.from("utilisateurs").insert([{id:s.id,email:s.email,nom:(null===(d=s.user_metadata)||void 0===d?void 0:d.nom)||"Utilisateur",telephone:(null===(h=s.user_metadata)||void 0===h?void 0:h.telephone)||"",role:"agent"}]);if(e){u("Erreur lors de l'enregistrement du profil."),console.error("âŒ Insert utilisateur :",e),c(!1);return}m.push("/dashboard");return}"admin"===l.role?m.push("/admin"):m.push("/dashboard"),c(!1)};return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,n.jsxs)("form",{onSubmit:handleLogin,className:"bg-white p-8 rounded-xl shadow-md w-full max-w-md space-y-5",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-center text-orange-600",children:"Connexion"}),o&&(0,n.jsx)("p",{className:"text-red-500 text-sm text-center",children:o}),(0,n.jsx)("input",{type:"email",placeholder:"Adresse email",value:e,onChange:e=>t(e.target.value),required:!0,className:"w-full border p-3 rounded"}),(0,n.jsx)("input",{type:"password",placeholder:"Mot de passe",value:r,onChange:e=>l(e.target.value),required:!0,className:"w-full border p-3 rounded"}),(0,n.jsx)("button",{type:"submit",disabled:d,className:"w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded transition",children:d?"Connexion...":"Se connecter"}),(0,n.jsxs)("p",{className:"text-sm text-center text-gray-600",children:["Pas encore de compte ?"," ",(0,n.jsx)("a",{href:"/register",className:"text-orange-600 hover:underline",children:"Cr\xe9er un compte"})]}),(0,n.jsx)("p",{className:"text-sm text-center text-gray-600 mt-2",children:(0,n.jsx)("a",{href:"/reset-password",className:"text-orange-600 hover:underline",children:"\uD83D\uDD11 Mot de passe oubli\xe9 ?"})})]})})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=6429)}),_N_E=e.O()}]);