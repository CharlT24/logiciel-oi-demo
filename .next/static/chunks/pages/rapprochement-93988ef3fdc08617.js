(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1550],{6631:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/rapprochement",function(){return s(8299)}])},8299:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Rapprochements}});var n=s(5893),a=s(7294),r=s(9846),l=s(1664),i=s.n(l);function Rapprochements(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)([]);(0,a.useEffect)(()=>{let fetchData=async()=>{let{data:e}=await r.O.from("clients").select("*"),{data:s}=await r.O.from("biens").select("*");t(e||[]),l((s||[]).filter(e=>!0===e.disponibilite))};fetchData();let e=r.O.channel("realtime-clients").on("postgres_changes",{event:"*",schema:"public",table:"clients"},fetchData).subscribe(),s=r.O.channel("realtime-biens").on("postgres_changes",{event:"*",schema:"public",table:"biens"},fetchData).subscribe();return()=>{r.O.removeChannel(e),r.O.removeChannel(s)}},[]);let biensCorrespondants=e=>s.filter(t=>{let s=parseFloat(t.prix_vente||0)+parseFloat(t.honoraires||0),n=parseFloat(e.budget_max||1/0),a=(t.ville||"").trim().toLowerCase(),r=(e.ville_recherche||"").trim().toLowerCase(),l=r.length>0&&a.includes(r),i=s<=n;return console.log("\uD83D\uDD0D Rapprochement simplifi\xe9 pour:",e.nom),console.log(" → Bien:",t.titre),console.log("    Ville OK:",l),console.log("    Prix FAI:",s,"| Budget Max:",n,"| Prix OK:",i),l&&i});return(0,n.jsxs)("div",{className:"space-y-10 max-w-6xl mx-auto px-6 py-10",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"\uD83D\uDD0D Rapprochements"}),(0,n.jsx)(i(),{href:"/recherche",children:(0,n.jsx)("button",{className:"bg-orange-100 text-orange-700 px-4 py-2 rounded hover:bg-orange-200 text-sm",children:"\uD83C\uDF10 Acc\xe8s au moteur Google"})})]}),(0,n.jsx)("div",{className:"grid md:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(e=>{var t,s;let a=biensCorrespondants(e),r=a.length>0;return(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow p-5 border space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-gray-800",children:e.nom||"Acqu\xe9reur sans nom"}),(0,n.jsx)("span",{className:"text-xs font-bold px-2 py-1 rounded-full "+(r?"bg-green-500 text-white":"bg-gray-300 text-gray-700"),children:r?"".concat(a.length," match"):"Aucun match"})]}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["\uD83D\uDCCD ",e.ville_recherche||"Ville inconnue"]}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["\uD83D\uDCB0 Budget : ",(null===(t=e.budget_min)||void 0===t?void 0:t.toLocaleString())||"0"," € – ",(null===(s=e.budget_max)||void 0===s?void 0:s.toLocaleString())||"Illimit\xe9"," €"]}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["\uD83C\uDFE0 Recherche : ",e.type_bien||"Non pr\xe9cis\xe9"]}),r&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-1",children:"\uD83C\uDFE1 Biens correspondants :"}),(0,n.jsx)("ul",{className:"text-sm space-y-1",children:a.map(e=>{let t=parseFloat(e.prix_vente||0)+parseFloat(e.honoraires||0);return(0,n.jsx)("li",{children:(0,n.jsxs)(i(),{href:"/biens/".concat(e.id),className:"text-orange-700 hover:underline",children:["\uD83D\uDCCD ",e.titre||"Bien sans titre"," — ",e.ville," — ",t.toLocaleString()," €"]})},e.id)})})]})]},e.id)})})]})}}},function(e){e.O(0,[1664,9774,2888,179],function(){return e(e.s=6631)}),_N_E=e.O()}]);