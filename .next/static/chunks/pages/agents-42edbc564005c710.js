(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1013],{5947:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agents",function(){return s(5701)}])},5701:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ListeUtilisateurs}});var l=s(5893),a=s(7294),r=s(9846),n=s(1664),i=s.n(n);function ListeUtilisateurs(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(null),[o,c]=(0,a.useState)("");(0,a.useEffect)(()=>{let fetchUser=async()=>{var e;let{data:{session:t}}=await r.O.auth.getSession(),s=null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id;if(!s)return;n(s);let{data:l}=await r.O.from("utilisateurs").select("role").eq("id",s).single();c((null==l?void 0:l.role)||"")},fetchAllUsers=async()=>{let{data:e,error:s}=await r.O.from("utilisateurs").select("*, agences(nom)");s||t(e)};fetchUser(),fetchAllUsers()},[]);let getUserPhoto=e=>{if(!e)return"/no-avatar.jpg";for(let t of["jpg","jpeg","png","webp"]){let s="https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/avatars/".concat(e,".").concat(t),l=new Image;if(l.src=s,l.complete||0!==l.naturalWidth)return"".concat(s,"?t=").concat(Date.now())}return"/no-avatar.jpg"},handleDelete=async s=>{if(!confirm("Confirmer la suppression de cet utilisateur ?"))return;let{error:l}=await r.O.from("utilisateurs").delete().eq("id",s);l||t(e.filter(e=>e.id!==s))};return(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-10 space-y-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"\uD83D\uDC65 Tous les utilisateurs"}),0===e.length?(0,l.jsx)("p",{className:"text-gray-500 mt-10",children:"Aucun utilisateur trouv\xe9."}):(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8",children:e.map(e=>{var t;let s=getUserPhoto(e.id);return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden flex flex-col relative",children:[(null===(t=e.agences)||void 0===t?void 0:t.nom)&&(0,l.jsxs)("div",{className:"absolute top-0 right-0 bg-orange-100 text-orange-600 text-xs font-semibold px-3 py-1 rounded-bl-xl",children:["\uD83C\uDFE2 ",e.agences.nom]}),(0,l.jsx)("img",{src:s,alt:e.nom,className:"w-full h-52 object-cover",onError:e=>{e.currentTarget.src="/no-avatar.jpg"}}),(0,l.jsxs)("div",{className:"p-5 space-y-2 flex-1 flex flex-col justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"font-semibold text-lg text-gray-800",children:e.prenom?"".concat(e.prenom," ").concat(e.nom):e.nom}),e.role&&(0,l.jsxs)("p",{className:"text-sm text-gray-400 italic",children:["\uD83D\uDC64 ",e.role]}),e.ville&&(0,l.jsx)("p",{className:"text-sm text-gray-500",children:e.ville}),e.telephone&&(0,l.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["\uD83D\uDCDE ",e.telephone]}),e.email&&(0,l.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["✉️ ",e.email]})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,l.jsx)(i(),{href:"/agents/".concat(e.id),legacyBehavior:!0,children:(0,l.jsx)("a",{className:"inline-block bg-orange-500 text-white text-sm font-semibold px-4 py-2 rounded hover:bg-orange-600 transition",children:"Voir la fiche"})}),"admin"===o&&(0,l.jsx)("button",{onClick:()=>handleDelete(e.id),className:"text-sm text-red-500 hover:underline ml-2",children:"Supprimer"})]})]})]},e.id)})})]})}}},function(e){e.O(0,[1664,9774,2888,179],function(){return e(e.s=5947)}),_N_E=e.O()}]);