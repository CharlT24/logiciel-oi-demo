(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7914],{8418:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/export",function(){return a(3918)}])},3918:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ExportPage}});var r=a(5893),s=a(7294),n=a(9846);let getSettings=async()=>{let{data:e}=await n.O.from("parametres").select("*"),t={};for(let a of e||[])t[a.cle]=a.valeur;return t};var i=a(3454);function ExportPage(){let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)([]),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let fetchData=async()=>{var e;let{data:{session:a}}=await n.O.auth.getSession(),r=null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.id;c(r);let{data:s}=await n.O.from("utilisateurs").select("role").eq("id",r).single(),i=(null==s?void 0:s.role)==="admin";u(i);let{data:o}=await n.O.from("biens").select("*"),d=i?o:o.filter(e=>e.agent_id===r);t(d||[]),await getSettings(),l(["ubiflow","seloger"])};fetchData()},[]);let toggleExport=async(a,r,s)=>{let l=e.find(e=>e.id===a),o=l.exports||{},c={...o,[r]:s};if(await n.O.from("biens").update({exports:c}).eq("id",a),t(e.map(e=>e.id===a?{...e,exports:c}:e)),s)try{await fetch("/api/export/".concat(r),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(i.env.NEXT_PUBLIC_CRON_SECRET)},body:JSON.stringify({biens:[a]})})}catch(e){alert("âŒ Erreur export ".concat(r," : ").concat(e.message))}};return(0,r.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"\uD83D\uDCE4 Export vers portails"}),0===a.length?(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Aucun portail activ\xe9 dans les param\xe8tres."}):(0,r.jsxs)("table",{className:"min-w-full text-sm border",children:[(0,r.jsx)("thead",{className:"bg-gray-100",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 border",children:"Titre"}),(0,r.jsx)("th",{className:"p-2 border",children:"Ville"}),a.map(e=>(0,r.jsx)("th",{className:"p-2 border text-xs capitalize",children:e},e))]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{className:"border-t hover:bg-orange-50 transition",children:[(0,r.jsx)("td",{className:"p-2 border font-medium",children:e.titre}),(0,r.jsx)("td",{className:"p-2 border",children:e.ville}),a.map(t=>{var a;let s="".concat(e.id,"_").concat(t),n=(null===(a=e.exports)||void 0===a?void 0:a[t])||!1;return(0,r.jsx)("td",{className:"p-2 text-center border",children:(0,r.jsx)("input",{type:"checkbox",checked:n,onChange:a=>toggleExport(e.id,t,a.target.checked),className:"w-5 h-5 text-orange-600 focus:ring-orange-500"})},s)})]},e.id))})]})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=8418)}),_N_E=e.O()}]);