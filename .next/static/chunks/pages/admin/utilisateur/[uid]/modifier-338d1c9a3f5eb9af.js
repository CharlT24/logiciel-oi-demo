(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5441],{6610:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/utilisateur/[uid]/modifier",function(){return l(3582)}])},3582:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return ModifierUtilisateur}});var n=l(5893),t=l(1163),r=l(7294),s=l(9846);function ModifierUtilisateur(){let e=(0,t.useRouter)(),{uid:a}=e.query,[l,o]=(0,r.useState)(null),[u,i]=(0,r.useState)([]),[d,c]=(0,r.useState)("");(0,r.useEffect)(()=>{a&&(s.O.from("utilisateurs").select("*").eq("id",a).single().then(e=>{let{data:a}=e;if(o(a),null==a?void 0:a.id){let e="https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/avatars/".concat(a.id,".jpg");c(e)}}),s.O.from("agences").select("id, nom").then(e=>{let{data:a}=e;return i(a)}))},[a]);let handleChange=e=>{let{name:a,value:l}=e.target;o(e=>({...e,[a]:l}))},handleFileChange=async e=>{let a=e.target.files[0];if(!a||!(null==l?void 0:l.id))return;let{error:n}=await s.O.storage.from("photos").upload("avatars/".concat(l.id,".jpg"),a,{upsert:!0});if(n){alert("Erreur lors de l’upload");return}let t="https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/avatars/".concat(l.id,".jpg");c(t),alert("✅ Photo mise \xe0 jour !")},handleSubmit=async n=>{n.preventDefault();let{error:t}=await s.O.from("utilisateurs").update(l).eq("id",a);t||e.push("/admin/parametres/utilisateurs")};return l?(0,n.jsxs)("div",{className:"p-6 max-w-xl mx-auto space-y-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Modifier l'utilisateur"}),d&&(0,n.jsx)("img",{src:d,alt:"avatar",className:"w-32 h-32 rounded-full object-cover border shadow"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:handleFileChange,className:"block mt-2 mb-4"}),(0,n.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,n.jsx)("input",{name:"prenom",value:l.prenom||"",onChange:handleChange,placeholder:"Pr\xe9nom",className:"w-full border p-2 rounded"}),(0,n.jsx)("input",{name:"nom",value:l.nom||"",onChange:handleChange,placeholder:"Nom",className:"w-full border p-2 rounded",required:!0}),(0,n.jsx)("input",{name:"email",value:l.email||"",onChange:handleChange,placeholder:"Email",className:"w-full border p-2 rounded"}),(0,n.jsx)("input",{name:"telephone",value:l.telephone||"",onChange:handleChange,placeholder:"T\xe9l\xe9phone",className:"w-full border p-2 rounded"}),(0,n.jsx)("input",{name:"ville",value:l.ville||"",onChange:handleChange,placeholder:"Ville",className:"w-full border p-2 rounded"}),(0,n.jsx)("input",{name:"rsac",value:l.rsac||"",onChange:handleChange,placeholder:"Num\xe9ro RSAC",className:"w-full border p-2 rounded"}),(0,n.jsxs)("select",{name:"agence_id",value:l.agence_id||"",onChange:handleChange,className:"w-full border p-2 rounded",children:[(0,n.jsx)("option",{value:"",children:"Aucune agence"}),u.map(e=>(0,n.jsx)("option",{value:e.id,children:e.nom},e.id))]}),(0,n.jsx)("button",{type:"submit",className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:"Enregistrer"})]})]}):(0,n.jsx)("p",{className:"p-6",children:"Chargement..."})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=6610)}),_N_E=e.O()}]);