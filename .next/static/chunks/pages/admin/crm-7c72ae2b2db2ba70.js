(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3993],{3252:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/crm",function(){return l(1416)}])},1416:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return AdminCRM}});var s=l(5893),n=l(7294),t=l(9846);function AdminCRM(){let[e,a]=(0,n.useState)(null),[l,r]=(0,n.useState)(""),[i,c]=(0,n.useState)([]),[d,o]=(0,n.useState)(""),[u,m]=(0,n.useState)({table:"",name:"",type:"text"});(0,n.useEffect)(()=>{let fetchParams=async()=>{let{data:e,error:l}=await t.O.from("parametres_crm").select("*").single();!l&&e?a(e):(await t.O.from("parametres_crm").insert({nom_agence:"Mon Agence",message_accueil:"Bienvenue sur votre espace professionnel.",couleur_primaire:"#f97316",types_biens:["Maison","Appartement","Terrain"]}),fetchParams())},fetchTypes=async()=>{let{data:e}=await t.O.from("types_biens").select("*").order("nom");c(e||[])};fetchParams(),fetchTypes()},[]);let handleChange=(e,l)=>{a(a=>({...a,[e]:l}))},handleDeleteType=e=>{a(a=>({...a,types_biens:a.types_biens.filter(a=>a!==e)}))},handleSave=async()=>{let{error:a}=await t.O.from("parametres_crm").update(e).eq("id",e.id);a?alert("❌ Erreur lors de l’enregistrement"):alert("✅ Param\xe8tres enregistr\xe9s")},handleInsertType=async()=>{if(!l)return;let{error:e}=await t.O.from("types_biens").insert({nom:l});if(e)alert("Erreur : "+e.message);else{r("");let{data:e}=await t.O.from("types_biens").select("*").order("nom");c(e||[])}},handleDeleteTypeSupabase=async e=>{await t.O.from("types_biens").delete().eq("id",e);let{data:a}=await t.O.from("types_biens").select("*").order("nom");c(a||[])},handleCreateTable=async()=>{if(!d)return;let{error:e}=await t.O.rpc("execute_sql",{sql:"CREATE TABLE IF NOT EXISTS ".concat(d," (id uuid PRIMARY KEY DEFAULT gen_random_uuid())")});e?alert("❌ Erreur cr\xe9ation : "+e.message):(alert("✅ Table cr\xe9\xe9e"),o(""))},handleAddColumn=async()=>{let{table:e,name:a,type:l}=u;if(!e||!a||!l)return;let{error:s}=await t.O.rpc("execute_sql",{sql:"ALTER TABLE ".concat(e," ADD COLUMN IF NOT EXISTS ").concat(a," ").concat(l)});s?alert("❌ Erreur colonne : "+s.message):(alert("✅ Colonne ajout\xe9e"),m({table:"",name:"",type:"text"}))};return e?(0,s.jsxs)("div",{className:"p-6 max-w-4xl mx-auto space-y-10 text-gray-800",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"⚙️ Param\xe8tres CRM"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-medium mb-1",children:"\uD83C\uDFE2 Nom de l’agence"}),(0,s.jsx)("input",{value:e.nom_agence,onChange:e=>handleChange("nom_agence",e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-medium mb-1",children:"\uD83D\uDCAC Message d’accueil"}),(0,s.jsx)("textarea",{value:e.message_accueil,onChange:e=>handleChange("message_accueil",e.target.value),className:"w-full border rounded p-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-medium mb-1",children:"\uD83C\uDFA8 Couleur principale"}),(0,s.jsx)("input",{type:"color",value:e.couleur_primaire,onChange:e=>handleChange("couleur_primaire",e.target.value),className:"h-10 w-24 border rounded"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block font-medium mb-2",children:"\uD83C\uDFF7️ Types de biens (config)"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,s.jsx)("input",{placeholder:"Ajouter un type",value:l,onChange:e=>r(e.target.value),className:"flex-1 border p-2 rounded"}),(0,s.jsx)("button",{onClick:()=>{l&&!e.types_biens.includes(l)&&(a(e=>({...e,types_biens:[...e.types_biens,l]})),r(""))},className:"bg-orange-500 text-white px-4 rounded hover:bg-orange-600",children:"Ajouter"})]}),(0,s.jsx)("ul",{className:"list-disc ml-6 text-sm text-gray-700",children:e.types_biens.map((e,a)=>(0,s.jsxs)("li",{className:"flex justify-between items-center",children:[e,(0,s.jsx)("button",{onClick:()=>handleDeleteType(e),className:"text-red-500 hover:underline text-xs",children:"Supprimer"})]},a))})]}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)("button",{onClick:handleSave,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700",children:"\uD83D\uDCBE Enregistrer les modifications"})}),(0,s.jsxs)("div",{className:"border-t pt-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-orange-600 mb-4",children:"\uD83D\uDCE6 Types de biens (base Supabase)"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsx)("input",{placeholder:"Type de bien",value:l,onChange:e=>r(e.target.value),className:"flex-1 border p-2 rounded"}),(0,s.jsx)("button",{onClick:handleInsertType,className:"bg-blue-600 text-white px-4 rounded hover:bg-blue-700",children:"Ajouter"})]}),(0,s.jsx)("ul",{className:"list-disc ml-6 text-sm",children:i.map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center",children:[e.nom,(0,s.jsx)("button",{onClick:()=>handleDeleteTypeSupabase(e.id),className:"text-red-500 text-xs hover:underline",children:"Supprimer"})]},e.id))})]}),(0,s.jsxs)("div",{className:"border-t pt-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-orange-600 mb-4",children:"\uD83D\uDCC2 Administration Supabase"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block font-medium mb-1",children:"\uD83C\uDD95 Cr\xe9er une table"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:d,onChange:e=>o(e.target.value),placeholder:"Nom de la nouvelle table",className:"flex-1 border p-2 rounded"}),(0,s.jsx)("button",{onClick:handleCreateTable,className:"bg-purple-600 text-white px-4 rounded hover:bg-purple-700",children:"Cr\xe9er"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block font-medium mb-1",children:"\uD83D\uDCD1 Ajouter une colonne"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)("input",{placeholder:"Table cible",value:u.table,onChange:e=>m({...u,table:e.target.value}),className:"border p-2 rounded"}),(0,s.jsx)("input",{placeholder:"Nom de colonne",value:u.name,onChange:e=>m({...u,name:e.target.value}),className:"border p-2 rounded"}),(0,s.jsx)("input",{placeholder:"Type SQL",value:u.type,onChange:e=>m({...u,type:e.target.value}),className:"border p-2 rounded"})]}),(0,s.jsx)("button",{onClick:handleAddColumn,className:"mt-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",children:"Ajouter la colonne"})]})]})]}):(0,s.jsx)("p",{className:"p-10 text-center",children:"Chargement..."})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=3252)}),_N_E=e.O()}]);