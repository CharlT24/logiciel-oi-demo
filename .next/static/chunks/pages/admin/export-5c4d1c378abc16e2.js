(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9698],{3362:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/export",function(){return a(7788)}])},7788:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ExportAdmin}});var n=a(5893),r=a(7294);function ExportAdmin(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)("leboncoin"),[l,i]=(0,r.useState)(["seloger","figaro","fnaim","greenacres","wordpress","ubiflow"]),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[m,b]=(0,r.useState)({url:"",username:"",password:"",destination:"",autoExport:!1});(0,r.useEffect)(()=>{fetch("/api/biens/exportables").then(e=>e.json()).then(e=>t(e.biens||[]))},[]);let handleExport=async()=>{u(!0),h("");try{let e=await fetch("/api/export/".concat(a)),t="seloger"===a,n=await e.text();c(n),h(t?"✅ Fichier CSV g\xe9n\xe9r\xe9":"✅ Fichier XML g\xe9n\xe9r\xe9")}catch(e){c("Erreur lors de la g\xe9n\xe9ration du fichier."),h("❌ Erreur serveur")}u(!1)},handleCredentialsChange=(e,t)=>{b(a=>({...a,[e]:t}))},handleSaveCredentials=async()=>{try{let e=await fetch("/api/export/save-credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({portail:a,...m})}),t=await e.json();t.success?h("\uD83D\uDD10 Identifiants enregistr\xe9s."):h("❌ Erreur enregistrement credentials")}catch(e){console.error(e),h("❌ \xc9chec serveur")}},[f,v]=(0,r.useState)(!1);return(0,n.jsxs)("div",{className:"max-w-5xl mx-auto py-10 space-y-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"Export vers portails"}),(0,n.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,n.jsx)("label",{className:"font-medium",children:"Portail :"}),(0,n.jsx)("select",{value:a,onChange:e=>s(e.target.value),className:"border px-3 py-2 rounded",children:l.filter(e=>!["leboncoin","bienici"].includes(e)).map(e=>(0,n.jsx)("option",{value:e,children:e},e))}),(0,n.jsx)("button",{onClick:handleExport,className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:"G\xe9n\xe9rer XML / CSV"}),(0,n.jsx)("a",{href:"/api/export/".concat(a),target:"_blank",rel:"noopener noreferrer",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"T\xe9l\xe9charger le fichier"})]}),o&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mt-6 mb-2",children:"Aper\xe7u du fichier :"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-4 rounded text-xs overflow-auto max-h-[400px] whitespace-pre-wrap",children:o}),(0,n.jsx)("a",{href:"data:text/plain;charset=utf-8,".concat(encodeURIComponent(o)),download:"export-".concat(a,".").concat("seloger"===a?"csv":"xml"),className:"inline-block mt-3 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"T\xe9l\xe9charger ce fichier"})]}),(0,n.jsx)("button",{onClick:()=>{let e="".concat(window.location.origin,"/api/export/").concat(a);navigator.clipboard.writeText(e).then(()=>{v(!0),setTimeout(()=>v(!1),2e3)})},className:"bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600",children:"Copier lien direct"}),(0,n.jsxs)("div",{className:"flex gap-4 mt-4 items-end",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium",children:"Ajouter un portail :"}),(0,n.jsx)("input",{value:p,onChange:e=>g(e.target.value),className:"border px-3 py-2 rounded w-48",placeholder:"nom-du-portail"})]}),(0,n.jsx)("button",{onClick:()=>{p&&(i([...l,p]),g(""))},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Ajouter"})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Coordonn\xe9es du portail s\xe9lectionn\xe9"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)("input",{placeholder:"URL/API Endpoint",className:"input",value:m.url||"",onChange:e=>handleCredentialsChange("url",e.target.value)}),(0,n.jsx)("input",{placeholder:"Utilisateur (si FTP/API)",className:"input",value:m.username||"",onChange:e=>handleCredentialsChange("username",e.target.value)}),(0,n.jsx)("input",{placeholder:"Mot de passe ou token",className:"input",type:"password",value:m.password||"",onChange:e=>handleCredentialsChange("password",e.target.value)}),(0,n.jsx)("input",{placeholder:"R\xe9pertoire ou config sp\xe9cifique",className:"input",value:m.destination||"",onChange:e=>handleCredentialsChange("destination",e.target.value)}),(0,n.jsxs)("label",{className:"col-span-2 flex items-center gap-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:m.autoExport||!1,onChange:e=>handleCredentialsChange("autoExport",e.target.checked)}),"Export automatique chaque nuit ?"]})]}),(0,n.jsx)("button",{onClick:handleSaveCredentials,className:"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded",children:"Sauvegarder les identifiants"})]}),x&&(0,n.jsx)("p",{className:"text-green-700 font-medium mt-4",children:x}),(0,n.jsxs)("div",{className:"bg-orange-50 p-4 rounded border text-sm",children:[(0,n.jsxs)("strong",{children:["Biens exportables : ",e.length]}),(0,n.jsx)("ul",{className:"list-disc ml-6",children:e.map(e=>(0,n.jsxs)("li",{children:[e.titre," (",e.ville,")"]},e.id))})]})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=3362)}),_N_E=e.O()}]);