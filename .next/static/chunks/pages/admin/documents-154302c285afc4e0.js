(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8462],{4501:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/documents",function(){return s(9757)}])},9757:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AdminDocuments}});var a=s(5893),n=s(7294),r=s(9846),l=s(1163);function AdminDocuments(){let e=(0,l.useRouter)(),[t,s]=(0,n.useState)([]),[c,o]=(0,n.useState)(!1),[i,u]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!1);(0,n.useEffect)(()=>{checkRoleAndFetchDocs()},[]);let checkRoleAndFetchDocs=async()=>{var t,s,a;let n=await r.O.auth.getSession(),l=null===(a=n.data)||void 0===a?void 0:null===(s=a.session)||void 0===s?void 0:null===(t=s.user)||void 0===t?void 0:t.id;if(!l)return;let{data:c}=await r.O.from("utilisateurs").select("role").eq("id",l).single();(null==c?void 0:c.role)==="admin"?(m(!0),fetchDocuments()):e.push("/dashboard")},fetchDocuments=async()=>{let{data:e,error:t}=await r.O.storage.from("documents").list("",{limit:100});t?console.error("Erreur r\xe9cup\xe9ration fichiers :",t):s(e)},handleUpload=async e=>{let t=e.target.files[0];if(!t)return;o(!0),u(!1);let s="".concat(Date.now(),"_").concat(t.name),{error:a}=await r.O.storage.from("documents").upload(s,t);a?alert("❌ Erreur lors de l’upload"):(u(!0),fetchDocuments()),o(!1)},handleDelete=async e=>{let{error:t}=await r.O.storage.from("documents").remove([e]);t?alert("❌ Erreur lors de la suppression"):(alert("✅ Fichier supprim\xe9 avec succ\xe8s"),fetchDocuments())},getPublicUrl=e=>r.O.storage.from("documents").getPublicUrl(e).data.publicUrl;return(0,a.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"\uD83D\uDCC1 Gestion des documents"}),d&&(0,a.jsxs)("div",{className:"bg-white p-6 border rounded-xl shadow space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold text-orange-700",children:"Uploader un fichier (PDF/Word)"}),(0,a.jsx)("input",{type:"file",accept:".pdf,.doc,.docx",onChange:handleUpload,className:"text-sm"}),c&&(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Envoi en cours..."}),i&&(0,a.jsx)("p",{className:"text-sm text-green-600",children:"✅ Document ajout\xe9 avec succ\xe8s"})]}),(0,a.jsxs)("div",{className:"mt-10",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Documents existants"}),0===t.length?(0,a.jsx)("p",{className:"text-gray-500",children:"Aucun document disponible."}):(0,a.jsx)("div",{className:"space-y-4 mt-4",children:t.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center border p-4 rounded-lg shadow hover:bg-gray-50 transition",children:[(0,a.jsx)("p",{className:"text-gray-700",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("a",{href:getPublicUrl(e.name),target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 hover:underline",children:"\uD83D\uDCE5 T\xe9l\xe9charger"}),d&&(0,a.jsx)("button",{onClick:()=>handleDelete(e.name),className:"text-red-600 hover:underline",children:"\uD83D\uDDD1️ Supprimer"})]})]},e.name))})]})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=4501)}),_N_E=e.O()}]);