(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1160],{6459:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/mandats",function(){return a(3405)}])},3405:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ListeMandats}});var n=a(5893),s=a(7294),r=a(9846),d=a(1163);function ListeMandats(){let[e,t]=(0,s.useState)([]),a=(0,d.useRouter)();(0,s.useEffect)(()=>{fetchMandats()},[]);let fetchMandats=async()=>{let{data:e,error:a}=await r.O.from("registres_mandats").select("*").eq("statut","provisoire").order("created_at",{ascending:!1});a||t(e)},validerMandat=async e=>{if(!confirm("Valider ce mandat d\xe9finitivement ?"))return;let{error:t}=await r.O.from("registres_mandats").update({statut:"valide",date_validation:new Date().toISOString()}).eq("id",e);t?alert("❌ Erreur validation"):(alert("✅ Mandat valid\xe9"),fetchMandats())},annulerMandat=async e=>{if(!confirm("Annuler ce mandat ?"))return;let{error:t}=await r.O.from("registres_mandats").update({statut:"annul\xe9",date_validation:new Date().toISOString()}).eq("id",e);t?alert("❌ Erreur annulation"):(alert("\uD83D\uDEAB Mandat annul\xe9"),fetchMandats())},isOlderThan5Days=e=>{let t=new Date(e),a=new Date;return Math.ceil(Math.abs(a-t)/864e5)>5};return(0,n.jsxs)("div",{className:"max-w-6xl mx-auto py-10 px-6 space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"\uD83D\uDCCB Mandats \xe0 valider"}),(0,n.jsx)("button",{onClick:()=>a.push("/admin/mandats/registre"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm",children:"\uD83D\uDCDC Voir le registre des mandats valid\xe9s"})]}),e.length>0&&(0,n.jsxs)("div",{className:"bg-yellow-100 text-yellow-800 p-4 rounded-xl text-center",children:["⚠️ ",e.length," mandat(s) en attente de validation !"]}),0===e.length?(0,n.jsx)("p",{className:"text-gray-500",children:"Aucun mandat \xe0 valider pour l'instant."}):(0,n.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,n.jsxs)("div",{className:"p-4 rounded-xl flex justify-between items-center shadow ".concat(isOlderThan5Days(e.created_at)?"bg-yellow-50 border border-yellow-300":"bg-white"),children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-lg font-bold text-gray-700",children:["Mandat #",e.numero_mandat]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Cr\xe9\xe9 le ",new Date(e.created_at).toLocaleDateString()]})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>validerMandat(e.id),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl text-sm",children:"✅ Valider"}),(0,n.jsx)("button",{onClick:()=>annulerMandat(e.id),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-xl text-sm",children:"❌ Annuler"})]})]},e.id))})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=6459)}),_N_E=e.O()}]);