(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{2523:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/visites/nouvelle",function(){return t(7128)}])},7128:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return CreerVisite}});var n=t(5893),s=t(7294),a=t(9846);function CreerVisite(){let[e,i]=(0,s.useState)([]),[t,l]=(0,s.useState)([]),[r,d]=(0,s.useState)({client_id:"",bien_id:"",date_visite:""}),[c,u]=(0,s.useState)(null);(0,s.useEffect)(()=>{let fetchData=async()=>{let{data:e}=await a.O.from("clients").select("id, nom"),{data:t}=await a.O.from("biens").select("id, titre");i(e||[]),l(t||[])};fetchData()},[]);let handleChange=e=>{let{name:i,value:t}=e.target;d(e=>({...e,[i]:t}))},handleSubmit=async e=>{e.preventDefault(),u(null);let{error:i}=await a.O.from("visites").insert([{client_id:r.client_id,bien_id:r.bien_id,date_visite:r.date_visite||new Date().toISOString().split("T")[0]}]);i?(u("Erreur lors de la cr\xe9ation de la visite ❌"),console.error(i)):u("Visite enregistr\xe9e ✅")};return(0,n.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow space-y-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-orange-600",children:"\uD83D\uDCDD Cr\xe9er une visite"}),c&&(0,n.jsx)("p",{className:"text-sm text-center text-green-600 font-medium",children:c}),(0,n.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("select",{name:"client_id",value:r.client_id,onChange:handleChange,className:"input",required:!0,children:[(0,n.jsx)("option",{value:"",children:"-- Choisir un acqu\xe9reur --"}),e.map(e=>(0,n.jsx)("option",{value:e.id,children:e.nom},e.id))]}),(0,n.jsxs)("select",{name:"bien_id",value:r.bien_id,onChange:handleChange,className:"input",required:!0,children:[(0,n.jsx)("option",{value:"",children:"-- Choisir un bien --"}),t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.titre},e.id))]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,n.jsx)("input",{type:"date",name:"date_visite",value:r.date_visite,onChange:handleChange,className:"input",placeholder:"Date de la visite"})}),(0,n.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[(0,n.jsx)("button",{type:"submit",className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:"\uD83D\uDCBE Enregistrer la visite"}),(0,n.jsx)("button",{type:"button",onClick:()=>{if(!r.client_id||!r.bien_id){alert("Veuillez choisir un acqu\xe9reur et un bien");return}let e="/documents/bon-de-visite?client_id=".concat(r.client_id,"&bien_id=").concat(r.bien_id);window.open(e,"_blank")},className:"text-sm text-orange-600 hover:underline",children:"\uD83D\uDCC4 T\xe9l\xe9charger bon de visite"})]})]})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=2523)}),_N_E=e.O()}]);