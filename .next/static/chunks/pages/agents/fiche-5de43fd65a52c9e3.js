(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5811],{4373:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/agents/fiche",function(){return a(8627)}])},1130:function(e,t,a){"use strict";a.d(t,{Z:function(){return AvatarUploader}});var l=a(5893),n=a(7294),r=a(9846);function AvatarUploader(e){let{userId:t,onUpload:a}=e,[s,o]=(0,n.useState)(!1),handleFileChange=async e=>{var l;let n=null===(l=e.target.files)||void 0===l?void 0:l[0];if(n&&t){o(!0);try{let e=await createImageBitmap(n),l=document.createElement("canvas");l.width=e.width,l.height=e.height;let s=l.getContext("2d");null==s||s.drawImage(e,0,0);let i=await new Promise(e=>l.toBlob(t=>e(t),"image/jpeg",.9)),u="avatars/".concat(t,".jpg"),{error:c}=await r.O.storage.from("photos").upload(u,i,{upsert:!0});if(c){console.error("❌ Upload \xe9chou\xe9 :",c.message),alert("❌ Erreur lors de l'envoi de la photo."),o(!1);return}let{data:d}=r.O.storage.from("photos").getPublicUrl(u);(null==d?void 0:d.publicUrl)&&a(d.publicUrl)}catch(e){console.error("❌ Erreur de conversion :",e),alert("❌ \xc9chec de traitement de l'image.")}o(!1)}};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:handleFileChange,disabled:s}),s&&(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"\uD83D\uDCE4 Envoi de l’image en cours..."})]})}},8627:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return FicheEditAgent}});var l=a(5893),n=a(7294),r=a(1163),s=a(9846),o=a(1130);function FicheEditAgent(){let[e,t]=(0,n.useState)(null),[a,i]=(0,n.useState)(!0),[u,c]=(0,n.useState)(!1),d=(0,r.useRouter)();(0,n.useEffect)(()=>{let fetchAgent=async()=>{var e;let{data:{session:a}}=await s.O.auth.getSession(),l=null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.id;if(!l){d.push("/login");return}let{data:n,error:r}=await s.O.from("utilisateurs").select("id, nom, email, ville, telephone, bio, photo_url").eq("id",l).single();r||(t(n),i(!1))};fetchAgent()},[]);let handleChange=a=>{let{name:l,value:n}=a.target;t({...e,[l]:n})},handleSave=async()=>{c(!0);let{error:t}=await s.O.from("utilisateurs").update({nom:e.nom,ville:e.ville,telephone:e.telephone,bio:e.bio}).eq("id",e.id);c(!1),t?alert("❌ Erreur lors de l'enregistrement"):alert("✅ Informations mises \xe0 jour avec succ\xe8s")},handlePhotoUpload=async a=>{let{error:l}=await s.O.from("utilisateurs").update({photo_url:a}).eq("id",e.id);l?alert("❌ Erreur lors de l’upload de la photo."):t(e=>({...e,photo_url:a+"?t=".concat(Date.now())}))};return a?(0,l.jsx)("p",{className:"text-center mt-20 text-gray-500",children:"Chargement du profil..."}):(0,l.jsxs)("div",{className:"max-w-xl mx-auto px-6 py-10 space-y-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"\uD83D\uDC64 Ma fiche agent"}),(0,l.jsxs)("div",{className:"text-center space-y-4",children:[(0,l.jsx)("img",{src:e.photo_url||"/no-avatar.jpg",alt:e.nom,className:"w-32 h-32 mx-auto rounded-full object-cover border",onError:e=>e.currentTarget.src="/no-avatar.jpg"}),(0,l.jsx)(o.Z,{userId:e.id,onUpload:handlePhotoUpload})]}),(0,l.jsxs)("div",{className:"space-y-4 mt-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"Nom"}),(0,l.jsx)("input",{name:"nom",value:e.nom,onChange:handleChange,className:"input w-full"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"Ville"}),(0,l.jsx)("input",{name:"ville",value:e.ville||"",onChange:handleChange,className:"input w-full"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"T\xe9l\xe9phone"}),(0,l.jsx)("input",{name:"telephone",value:e.telephone||"",onChange:handleChange,className:"input w-full"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"Bio"}),(0,l.jsx)("textarea",{name:"bio",value:e.bio||"",onChange:handleChange,className:"input w-full",rows:5,placeholder:"Parlez un peu de vous..."})]})]}),(0,l.jsx)("button",{onClick:handleSave,disabled:u,className:"bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700 transition mt-6",children:u?"\uD83D\uDCBE Enregistrement...":"\uD83D\uDCBE Enregistrer mes infos"})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=4373)}),_N_E=e.O()}]);