(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2995],{9495:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[id]/modifier",function(){return a(7580)}])},7580:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return ModifierBien}});var o=a(5893),r=a(1163),i=a(7294),l=a(9846);function ModifierBien(){let e=(0,r.useRouter)(),{id:n}=e.query,[a,t]=(0,i.useState)({titre:"",ville:"",prix:"",surface_m2:"",dpe:"",description:"",honoraires:"",disponible:!0,sous_compromis:!1,vendu:!1,export_leboncoin:!1,export_seloger:!1}),[s,c]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!n)return;let fetchBien=async()=>{let{data:e}=await l.O.from("biens").select("*").eq("id",n).single();if(e){t(e);let{data:n}=l.O.storage.from("photos-biens").getPublicUrl("".concat(e.id,"/main.jpg"));c((null==n?void 0:n.publicUrl)||"")}};fetchBien()},[n]);let handleChange=e=>{let{name:n,value:o,type:r,checked:i}=e.target;t({...a,[n]:"checkbox"===r?i:o})},handleImageUpload=async e=>{let a="".concat(n,"/main.jpg"),{error:o}=await l.O.storage.from("photos-biens").upload(a,e,{upsert:!0});if(!o){let{data:e}=l.O.storage.from("photos-biens").getPublicUrl(a);c(null==e?void 0:e.publicUrl)}},generateDescription=async()=>{let e="R\xe9dige une description immobili\xe8re pour un bien \xe0 ".concat(a.ville,', type "').concat(a.titre,'", ').concat(a.surface_m2," m\xb2, DPE ").concat(a.dpe,", au prix de ").concat(a.prix," €."),n=await fetch("/api/generate-description",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e})}),o=await n.json();o.text&&t(e=>({...e,description:o.text}))},handleSubmit=async o=>{o.preventDefault();let{error:r}=await l.O.from("biens").update({...a,prix:Number(a.prix),surface_m2:Number(a.surface_m2),honoraires:Number(a.honoraires)}).eq("id",n);if(r)alert("❌ Erreur mise \xe0 jour"),console.error(r);else{var i,t;let n=null===(t=document.querySelector("#photo-upload"))||void 0===t?void 0:null===(i=t.files)||void 0===i?void 0:i[0];n&&await handleImageUpload(n),alert("✅ Bien modifi\xe9"),e.push("/biens")}};return a.titre?(0,o.jsxs)("div",{className:"p-8 max-w-2xl mx-auto bg-white rounded shadow mt-8 space-y-4",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold",children:"✏️ Modifier un bien"}),(0,o.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,o.jsx)("input",{name:"titre",value:a.titre,onChange:handleChange,placeholder:"Titre",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{name:"ville",value:a.ville,onChange:handleChange,placeholder:"Ville",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"prix",value:a.prix,onChange:handleChange,placeholder:"Prix (€)",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"surface_m2",value:a.surface_m2,onChange:handleChange,placeholder:"Surface (m\xb2)",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{name:"dpe",value:a.dpe,onChange:handleChange,placeholder:"DPE",className:"w-full p-2 border rounded"}),(0,o.jsx)("input",{type:"number",name:"honoraires",value:a.honoraires,onChange:handleChange,placeholder:"Honoraires (€)",className:"w-full p-2 border rounded"}),(0,o.jsx)("textarea",{name:"description",value:a.description,onChange:handleChange,placeholder:"Description compl\xe8te",rows:"4",className:"w-full p-2 border rounded"}),(0,o.jsx)("button",{type:"button",onClick:generateDescription,className:"bg-gray-200 text-sm px-2 py-1 rounded hover:bg-gray-300",children:"✨ G\xe9n\xe9rer automatiquement"}),s&&(0,o.jsx)("img",{src:s,alt:"Photo",className:"w-full rounded shadow"}),(0,o.jsx)("input",{id:"photo-upload",type:"file",accept:"image/*",className:"block mt-2"}),(0,o.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"disponible",checked:a.disponible,onChange:handleChange})," Disponible"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"sous_compromis",checked:a.sous_compromis,onChange:handleChange})," Sous compromis"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"vendu",checked:a.vendu,onChange:handleChange})," Vendu"]})]}),(0,o.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,o.jsx)("p",{className:"font-semibold mb-2",children:"\uD83C\uDF10 Export :"}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"export_leboncoin",checked:a.export_leboncoin,onChange:handleChange})," LeBonCoin"]}),(0,o.jsx)("br",{}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",name:"export_seloger",checked:a.export_seloger,onChange:handleChange})," SeLoger"]})]}),(0,o.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"\uD83D\uDCBE Enregistrer"})]})]}):(0,o.jsx)("div",{className:"p-8",children:"Chargement..."})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=9495)}),_N_E=e.O()}]);