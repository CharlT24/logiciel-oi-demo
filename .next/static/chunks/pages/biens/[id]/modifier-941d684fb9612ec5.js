(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3324],{8033:function(e,a,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/[id]/modifier",function(){return n(6239)}])},6239:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return ModifierBien}});var l=n(5893),t=n(7294),s=n(1163),r=n(9846),i=n(5934),o=n(6941);let c=["Chauffage individuel","Climatisation","Double vitrage","Fibre optique","Jardin","Terrasse","Balcon","Piscine","Garage","Cave","Ascenseur","Interphone","Portail automatique","Acc\xe8s PMR","S\xe9jour lumineux","Cuisine \xe9quip\xe9e","Cuisine am\xe9ricaine","Suite parentale","Combles am\xe9nageables","Alarme","Vue d\xe9gag\xe9e","Vue mer","Parking","Exposition Sud","Exposition Est","Exposition Nord","Exposition Ouest","Dernier \xe9tage","Plain-pied"];function ModifierBien(){let e=(0,s.useRouter)(),{id:a}=e.query,[n,u]=(0,t.useState)(null),[d,h]=(0,t.useState)(!0),[x,m]=(0,t.useState)(null),[p,g]=(0,t.useState)([]),[b,f]=(0,t.useState)([]),[C,v]=(0,t.useState)({nom:"",nomCustom:"",surface:""}),[j,y]=(0,t.useState)([]),[D,_]=(0,t.useState)(!1),[N,S]=(0,t.useState)(""),[T,w]=(0,t.useState)([]);(0,t.useEffect)(()=>{let fetchBien=async()=>{if(!a)return;let{data:e,error:n}=await r.O.from("biens").select("*").eq("id",a).single();if(n)console.error("Erreur chargement du bien:",n);else{let a=[];try{a=Array.isArray(e.gallery)?e.gallery:JSON.parse(e.gallery||"[]")}catch(e){console.warn("Gallery parsing error:",e)}u({...e,gallery:a}),f(e.pieces?JSON.parse(e.pieces):[]),y(e.options||[])}h(!1)};fetchBien()},[a]),(0,t.useEffect)(()=>{let fetchTypes=async()=>{let{data:e,error:a}=await r.O.from("types_ubiflow").select("label").order("label",{ascending:!0});a||w(e.map(e=>e.label))};fetchTypes()},[]);let handleChange=e=>{let{name:a,value:n,type:l,checked:t}=e.target,s="checkbox"===l?t:n;u(e=>({...e,[a]:s}))},toggleOption=e=>{y(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},handleCoverUpload=async e=>{let n=e.target.files[0];if(!n)return;let l="covers/".concat(a,"/").concat("cover.jpg");await r.O.storage.from("photos").upload(l,n,{upsert:!0})},handleGalleryUpload=async e=>{let n=Array.from(e.target.files),l=[];for(let e of n){let n=e.name.split(".").pop(),t="".concat((0,i.Z)(),".").concat(n),s="gallery/".concat(a,"/").concat(t),{error:o}=await r.O.storage.from("photos").upload(s,e);o||l.push(t)}u(e=>({...e,gallery:[...e.gallery||[],...l]}))},handleDeleteGalleryImage=async e=>{let n="gallery/".concat(a,"/").concat(e),{error:l}=await r.O.storage.from("photos").remove([n]);l||u(a=>({...a,gallery:a.gallery.filter(a=>a!==e)}))},handleSubmit=async l=>{l.preventDefault();let t={...n,pieces:JSON.stringify(b),options:D&&N.trim()?[...j,N.trim()]:j};delete t.id,delete t.created_at;let{error:s}=await r.O.from("biens").update(t).eq("id",a);s?console.error("Erreur \xe0 la mise \xe0 jour:",s.message):(alert("✅ Bien mis \xe0 jour"),e.push("/biens/".concat(a)))};if(d||!n)return(0,l.jsx)("p",{className:"text-center mt-10",children:"Chargement..."});let I="https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/covers/".concat(a,"/cover.jpg"),k=Array.isArray(n.gallery)?n.gallery:[];return(0,l.jsxs)("div",{className:"max-w-5xl mx-auto p-10",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-6 text-orange-600",children:"Modifier le Bien"}),(0,l.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,l.jsx)(TextInput,{label:"Titre",name:"titre",value:n.titre,onChange:handleChange}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type de bien"}),(0,l.jsxs)("select",{name:"type_bien",value:n.type_bien||"",onChange:handleChange,className:"w-full border rounded px-3 py-2",children:[(0,l.jsx)("option",{value:"",children:"-- S\xe9lectionner --"}),T.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]}),(0,l.jsx)(TextInput,{label:"Ville",name:"ville",value:n.ville,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Code postal",name:"code_postal",value:n.code_postal,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Mandat (non modifiable)",name:"mandat",value:n.mandat,onChange:handleChange,disabled:!0}),(0,l.jsx)(TextInput,{label:"\uD83D\uDCD0 Surface (m\xb2)",name:"surface_m2",value:n.surface_m2,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83D\uDECF️ Chambres",name:"nb_chambres",value:n.nb_chambres,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83D\uDECB️ Pi\xe8ces",name:"nb_pieces",value:n.nb_pieces,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83C\uDFE2 \xc9tage",name:"etage",value:n.etage,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83C\uDFD7️ Ann\xe9e",name:"annee_construction",value:n.annee_construction,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83D\uDD25 Chauffage",name:"type_chauffage",value:n.type_chauffage,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83C\uDF0D Terrain (m\xb2)",name:"terrain_m2",value:n.terrain_m2,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"\uD83D\uDCD0 Carrez (m\xb2)",name:"surface_carrez",value:n.surface_carrez,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Prix net vendeur (€)",name:"prix_net_vendeur",value:n.prix_net_vendeur,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Honoraires (€)",name:"honoraires",value:n.honoraires,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Prix de vente (€)",name:"prix_vente",value:n.prix_vente,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"DPE",name:"dpe",value:n.dpe,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Indice conso \xe9nergie",name:"dpe_conso_indice",value:n.dpe_conso_indice,onChange:handleChange}),(0,l.jsx)(TextInput,{label:"Indice GES",name:"dpe_ges_indice",value:n.dpe_ges_indice,onChange:handleChange}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)("label",{children:"\uD83E\uDDF1 Pi\xe8ces :"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)("select",{value:C.nom,onChange:e=>v({...C,nom:e.target.value}),children:[(0,l.jsx)("option",{value:"",children:"S\xe9lectionner"}),["Salon","Cuisine","Chambre","Salle de bain","Autre"].map(e=>(0,l.jsx)("option",{children:e},e))]}),"Autre"===C.nom&&(0,l.jsx)("input",{type:"text",placeholder:"Nom personnalis\xe9",value:C.nomCustom,onChange:e=>v({...C,nomCustom:e.target.value})}),(0,l.jsx)("input",{type:"text",placeholder:"Surface",value:C.surface,onChange:e=>v({...C,surface:e.target.value})}),(0,l.jsx)("button",{type:"button",onClick:()=>{let e="Autre"===C.nom?C.nomCustom:C.nom;e&&C.surface&&(f([...b,{nom:e,surface:C.surface}]),v({nom:"",nomCustom:"",surface:""}))},children:"➕"})]}),(0,l.jsx)("ul",{className:"col-span-2",children:b.map((e,a)=>(0,l.jsxs)("li",{children:["• ",e.nom," - ",e.surface," m\xb2"]},a))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block font-semibold text-orange-600",children:"⚙️ Options"}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-y-2 gap-x-6",children:c.map((e,a)=>(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"w-6 flex justify-center",children:(0,l.jsx)("input",{type:"checkbox",checked:j.includes(e),onChange:()=>toggleOption(e),className:"accent-orange-600"})}),(0,l.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e})]},a))}),(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:D,onChange:e=>_(e.target.checked),className:"mr-2"})," Autre :",D&&(0,l.jsx)("textarea",{className:"w-full mt-2 border rounded p-2",value:N,onChange:e=>S(e.target.value)})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\uD83D\uDCCC Statut du Bien"}),(0,l.jsxs)("select",{name:"statut",value:n.statut||"",onChange:handleChange,className:"w-full border rounded px-3 py-2",children:[(0,l.jsx)("option",{value:"",children:"-- S\xe9lectionner --"}),(0,l.jsx)("option",{value:"Disponible",children:"Disponible"}),(0,l.jsx)("option",{value:"Sous compromis",children:"Sous compromis"}),(0,l.jsx)("option",{value:"Vendu",children:"Vendu"}),(0,l.jsx)("option",{value:"Archiv\xe9",children:"Archiv\xe9"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{children:"\uD83D\uDCF8 Couverture"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:handleCoverUpload}),a&&(0,l.jsx)("img",{src:I,className:"w-full max-h-60 object-cover rounded mt-2",alt:"cover"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{children:"\uD83D\uDDBC️ Galerie"}),(0,l.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:handleGalleryUpload}),(0,l.jsx)(o.ReactSortable,{list:k,setList:e=>u(a=>({...a,gallery:e})),className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:k.map(e=>(0,l.jsxs)("div",{"data-id":e,className:"relative",children:[(0,l.jsx)("img",{src:"https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/gallery/".concat(a,"/").concat(e),alt:"",className:"w-full h-32 object-cover rounded"}),(0,l.jsx)("button",{type:"button",onClick:()=>handleDeleteGalleryImage(e),className:"absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded",children:"\uD83D\uDDD1️"})]},e))})]}),(0,l.jsx)("div",{className:"mb-4 text-center",children:(0,l.jsx)("button",{type:"button",onClick:()=>e.back(),className:"text-sm text-orange-600 hover:underline",children:"← Retour sans enregistrer"})}),(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("button",{type:"submit",className:"bg-orange-600 hover:bg-orange-700 text-white font-semibold px-6 py-2 rounded",children:"\uD83D\uDCBE Sauvegarder les modifications"})})]})]})}function TextInput(e){let{label:a,name:n,value:t,onChange:s,disabled:r=!1}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,l.jsx)("input",{type:"text",name:n,value:t||"",onChange:s,disabled:r,className:"w-full border rounded px-3 py-2"})]})}}},function(e){e.O(0,[7308,9774,2888,179],function(){return e(e.s=8033)}),_N_E=e.O()}]);