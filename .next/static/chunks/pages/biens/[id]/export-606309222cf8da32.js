(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7673],{3034:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/[id]/export",function(){return n(8650)}])},8650:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ExportBien}});var c=n(5893),r=n(7294),a=n(1163),o=n(9846);let generateXML=e=>{let t='<?xml version="1.0" encoding="UTF-8"?>\n<client>\n';for(let n of e)t+="  <annonce>\n"+"    <id>".concat(n.id,"</id>\n")+"    <titre><![CDATA[".concat(n.titre||"","]]></titre>\n")+"    <texte><![CDATA[".concat(n.description||"","]]></texte>\n")+"    <code_postal>".concat(n.code_postal||"","</code_postal>\n")+"    <ville>".concat(n.ville||"","</ville>\n")+"    <code_type>".concat(n.code_type||"1200","</code_type>\n")+"    <prix>".concat(n.prix_vente||0,"</prix>\n")+"    <surface>".concat(n.surface_m2||0,"</surface>\n")+"    <nombre_pieces>".concat(n.nb_pieces||"","</nombre_pieces>\n")+"    <nombre_chambres>".concat(n.nb_chambres||"","</nombre_chambres>\n")+"    <etage>".concat(n.etage||"","</etage>\n")+"    <dpe>".concat(n.dpe||"","</dpe>\n")+"    <ges>".concat(n.dpe_ges_indice||"","</ges>\n"),n.gallery&&Array.isArray(n.gallery)&&n.gallery.forEach(e=>{t+="    <photo>".concat("https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/gallery/".concat(n.id,"/").concat(e),"</photo>\n")}),t+="  </annonce>\n";return t+="</client>\n"};function ExportBien(){let e=(0,a.useRouter)(),{id:t}=e.query,[n,i]=(0,r.useState)(null),[s,l]=(0,r.useState)(!0),[d,p]=(0,r.useState)("");return((0,r.useEffect)(()=>{if(!t)return;let fetchBien=async()=>{let{data:e,error:n}=await o.O.from("biens").select("*").eq("id",t).single();if(!n&&e){i(e);let t=generateXML([e]);p(t),fetch("/api/export/send",{method:"POST",headers:{"Content-Type":"text/plain"},body:t})}l(!1)};fetchBien()},[t]),s)?(0,c.jsx)("p",{className:"text-center mt-10",children:"Chargement du bien..."}):n?(0,c.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,c.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"\uD83D\uDCE4 Export du bien"}),(0,c.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow space-y-2",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Titre :"})," ",n.titre]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Ville :"})," ",n.ville]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Prix :"})," ",n.prix," €"]})]}),(0,c.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow space-y-4",children:[(0,c.jsx)("h2",{className:"text-lg font-semibold text-gray-700",children:"\uD83D\uDCC4 Aper\xe7u XML"}),(0,c.jsx)("pre",{className:"bg-gray-100 text-xs p-4 rounded overflow-x-auto",children:d}),(0,c.jsx)("button",{onClick:()=>{let e=new Blob([d],{type:"application/xml"}),t=URL.createObjectURL(e),c=document.createElement("a");c.href=t,c.download="bien-".concat(n.id,".xml"),c.click(),URL.revokeObjectURL(t)},className:"bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700 transition",children:"⬇️ T\xe9l\xe9charger le fichier XML"})]})]}):(0,c.jsx)("p",{className:"text-center mt-10 text-red-500",children:"Bien introuvable."})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=3034)}),_N_E=e.O()}]);