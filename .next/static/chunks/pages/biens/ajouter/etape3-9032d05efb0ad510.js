(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6008],{7305:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/ajouter/etape3",function(){return a(6148)}])},6148:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Etape3UploadPhotos}});var r=a(5893),o=a(7294),s=a(1163),l=a(9846),n=a(5675),c=a.n(n),d=a(1664),i=a.n(d);function Etape3UploadPhotos(){let e=(0,s.useRouter)(),{id:t}=e.query,[a,n]=(0,o.useState)(null),[d,u]=(0,o.useState)([]),[h,p]=(0,o.useState)(null),[x,m]=(0,o.useState)([]),[g,f]=(0,o.useState)(0);(0,o.useEffect)(()=>{t&&console.log("\uD83D\uDD0D ID du bien :",t)},[t]);let handleUpload=async()=>{if(!t)return alert("ID de bien manquant.");try{let r=d.length+(a?1:0),o=0;if(a){let{error:e}=await l.O.storage.from("photos").upload("covers/".concat(t,"/cover.jpg"),a,{upsert:!0});if(e)throw e;o++,f(Math.round(o/r*100))}for(let e=0;e<d.length;e++){let a=d[e],s="".concat(Date.now(),"-").concat(e,"-").concat(a.name),{error:n}=await l.O.storage.from("photos").upload("gallery/".concat(t,"/").concat(s),a,{upsert:!0});if(n)throw n;o++,f(Math.round(o/r*100))}alert("✅ Photos upload\xe9es avec succ\xe8s"),e.push("/biens/ajouter/etape4?id=".concat(t))}catch(e){console.error("❌ Erreur d’upload :",e),alert("Erreur lors de l’upload")}},previewFile=(e,t)=>{let a=new FileReader;a.onloadend=()=>{t(a.result)},a.readAsDataURL(e)},previewGallery=e=>{let t=[];Array.from(e).forEach(a=>{let r=new FileReader;r.onloadend=()=>{t.push(r.result),t.length===e.length&&m(t)},r.readAsDataURL(a)})};return(0,r.jsxs)("div",{className:"space-y-8 max-w-4xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-orange-600",children:"\uD83D\uDCF8 \xc9tape 3 : Ajoutez des photos"}),(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow p-6 space-y-4 border",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-800",children:"\uD83D\uDDBC️ Photo de couverture"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];t&&(n(t),previewFile(t,p))},className:"text-sm"}),h&&(0,r.jsx)(c(),{src:h,alt:"Preview",width:400,height:300,className:"rounded border mt-2 object-cover"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow p-6 space-y-4 border",children:[(0,r.jsx)("h2",{className:"font-semibold text-gray-800",children:"\uD83D\uDDC2️ Galerie (jusqu’\xe0 20 photos)"}),(0,r.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files);if(t.length>20){alert("❌ Vous pouvez uploader maximum 20 photos.");return}u(t),previewGallery(t)},className:"text-sm"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:x.map((e,t)=>(0,r.jsx)(c(),{src:e,alt:"photo-".concat(t),width:150,height:150,className:"rounded object-cover border"},t))})]})]}),g>0&&g<100&&(0,r.jsx)("div",{className:"bg-gray-200 rounded-full h-4 overflow-hidden",children:(0,r.jsx)("div",{className:"bg-orange-500 h-4 transition-all",style:{width:"".concat(g,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(i(),{href:"/biens/ajouter/etape2?id=".concat(t),className:"text-sm text-orange-600 hover:underline",children:"⬅️ Retour \xe0 l’\xe9tape 2"}),(0,r.jsx)("button",{onClick:handleUpload,className:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded shadow",children:"✅ Enregistrer et passer \xe0 l’\xe9tape 4"})]})]})}}},function(e){e.O(0,[1664,9774,2888,179],function(){return e(e.s=7305)}),_N_E=e.O()}]);