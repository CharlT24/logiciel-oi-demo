(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6974],{8156:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/ajouter/etape2",function(){return a(4164)}])},4164:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return Etape2}});var t=a(5893),r=a(1163),s=a(7294),l=a(9846),o=a(1664),i=a.n(o);function Etape2(){let e=(0,r.useRouter)(),{id:n}=e.query,[a,o]=(0,s.useState)({surface_m2:"",nb_pieces:"",nb_chambres:"",etage:"",dpe_conso_indice:"",dpe_ges_indice:"",energie_finale_kwh:"",dpe_vierge:!1,type_chauffage:"",type_chauffage_secondaire:"",annee_construction:"",surface_terrain:"",surface_carrez:"",prix_vente:"",prix_net_vendeur:"",honoraires:"",pourcentage_honoraires:"",taxe_fonciere:"",quote_part_charges:"",fonds_travaux:"",charge_vendeur:!1,charge_acquereur:!1,description:"",type_offre:"V",loyer_mensuel:"",honoraires_location:"",bareme:"",dpe_etiquette_conso:"",dpe_etiquette_ges:"",dpe_date_realisation:"",date_indice_prix_energies:"",montant_depenses_energies_min:"",montant_depenses_energies_max:"",montant_depense_energie_estime:"",altitude:""}),[u,c]=(0,s.useState)(null),[d,h]=(0,s.useState)([]),[p,x]=(0,s.useState)({nom:"",surface:""}),[m,_]=(0,s.useState)(!1),handleChange=e=>{let{name:n,value:a,type:t,checked:r}=e.target,s="checkbox"===t?r:a;o(e=>{let t={...e,[n]:s};if(["prix_net_vendeur","honoraires"].includes(n)){let r=parseFloat("prix_net_vendeur"===n?a:e.prix_net_vendeur||0),s=parseFloat("honoraires"===n?a:e.honoraires||0);t.prix_vente=(r+s).toFixed(2),t.pourcentage_honoraires=r>0?(s/r*100).toFixed(2):""}return t})},toFloat=e=>""===e?null:parseFloat(e),toInt=e=>""===e?null:parseInt(e),handleSubmit=async t=>{if(t.preventDefault(),!a.dpe_vierge&&(!a.dpe_conso_indice||!a.dpe_ges_indice)){c("Veuillez renseigner les indices DPE ou cocher 'DPE vierge'");return}let r={...a,surface_m2:toFloat(a.surface_m2),nb_pieces:toInt(a.nb_pieces),nb_chambres:toInt(a.nb_chambres),prix_vente:toFloat(a.prix_vente),prix_net_vendeur:toFloat(a.prix_net_vendeur),honoraires:toFloat(a.honoraires),pourcentage_honoraires:toFloat(a.pourcentage_honoraires),dpe_cout_min:toInt(a.dpe_cout_min),dpe_cout_max:toInt(a.dpe_cout_max),energie_finale_kwh:toInt(a.energie_finale_kwh),taxe_fonciere:toInt(a.taxe_fonciere),quote_part_charges:toInt(a.quote_part_charges),fonds_travaux:toInt(a.fonds_travaux),pieces:JSON.stringify(d)},s=Object.fromEntries(Object.entries(r).filter(e=>{let[n,a]=e;return""!==a&&void 0!==a})),{error:o}=await l.O.from("biens").update(s).eq("id",n);o?(console.error("❌ Erreur Supabase :",o),c("Erreur lors de la mise \xe0 jour")):e.push("/biens/ajouter/etape3?id=".concat(n))},handleGenerateDescription=async()=>{_(!0);let e=await fetch("/api/ia/description",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({titre:"Bien immobilier",surface:a.surface_m2,ville:"ville inconnue",prix:a.prix_vente,type:"appartement ou maison",description:a.description,pieces:d})}),n=await e.json();o(e=>({...e,description:n.description})),_(!1)},g=["Aucun","Gaz","\xc9lectrique","Fioul","Bois","Pompe \xe0 chaleur","Solaire","Climatisation r\xe9versible","R\xe9seau urbain","Autre"];return(0,t.jsxs)("div",{className:"max-w-5xl mx-auto bg-white rounded-xl shadow p-10 mt-10 space-y-6 border",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"\uD83D\uDCD0 \xc9tape 2 : Caract\xe9ristiques d\xe9taill\xe9es"}),u&&(0,t.jsx)("p",{className:"text-red-600 text-sm",children:u}),(0,t.jsxs)("form",{onSubmit:handleSubmit,className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[(0,t.jsx)(Input,{label:"Surface (m\xb2)*",name:"surface_m2",value:a.surface_m2,onChange:handleChange,required:!0}),(0,t.jsx)(Input,{label:"Surface terrain (m\xb2)",name:"surface_terrain",value:a.surface_terrain,onChange:handleChange}),(0,t.jsx)(Input,{label:"Surface Carrez",name:"surface_carrez",value:a.surface_carrez,onChange:handleChange}),(0,t.jsx)(Input,{label:"Nombre de pi\xe8ces*",name:"nb_pieces",value:a.nb_pieces,onChange:handleChange,required:!0}),(0,t.jsx)(Input,{label:"Nombre de chambres",name:"nb_chambres",value:a.nb_chambres,onChange:handleChange}),(0,t.jsx)(Input,{label:"\xc9tage",name:"etage",value:a.etage,onChange:handleChange}),(0,t.jsx)(Select,{label:"DPE - \xc9tiquette conso",name:"dpe_etiquette_conso",value:a.dpe_etiquette_conso,onChange:handleChange,options:["A","B","C","D","E","F","G"]}),(0,t.jsx)(Select,{label:"DPE - \xc9tiquette GES",name:"dpe_etiquette_ges",value:a.dpe_etiquette_ges,onChange:handleChange,options:["A","B","C","D","E","F","G"]}),(0,t.jsx)(Input,{label:"Indice consommation (kWhEP/m\xb2.an)",name:"dpe_conso_indice",value:a.dpe_conso_indice,onChange:handleChange}),(0,t.jsx)(Input,{label:"Indice GES (kg CO₂/m\xb2.an)",name:"dpe_ges_indice",value:a.dpe_ges_indice,onChange:handleChange}),(0,t.jsx)(Input,{label:"\xc9nergie finale (kWh/an)",name:"energie_finale_kwh",value:a.energie_finale_kwh,onChange:handleChange}),(0,t.jsx)(Input,{label:"Date de r\xe9alisation DPE",name:"dpe_date_realisation",value:a.dpe_date_realisation,onChange:handleChange}),(0,t.jsxs)("label",{className:"col-span-2 inline-flex items-center mt-2",children:[(0,t.jsx)("input",{type:"checkbox",name:"dpe_vierge",checked:a.dpe_vierge,onChange:handleChange,className:"mr-2"}),"Ce bien est ",(0,t.jsx)("strong",{className:"ml-1",children:"exempt\xe9 de DPE (vierge)"})]}),(0,t.jsx)(Select,{label:"Type de chauffage",name:"type_chauffage",value:a.type_chauffage,onChange:handleChange,options:g}),(0,t.jsx)(Select,{label:"Type de chauffage secondaire",name:"type_chauffage_secondaire",value:a.type_chauffage_secondaire,onChange:handleChange,options:g}),(0,t.jsx)(Input,{label:"Mode de chauffage",name:"mode_chauffage",value:a.mode_chauffage,onChange:handleChange}),(0,t.jsx)(Input,{label:"Ann\xe9e de construction",name:"annee_construction",value:a.annee_construction,onChange:handleChange}),(0,t.jsx)(Input,{label:"Prix net vendeur (€)*",name:"prix_net_vendeur",value:a.prix_net_vendeur,onChange:handleChange,required:!0}),(0,t.jsx)(Input,{label:"Honoraires (€)*",name:"honoraires",value:a.honoraires,onChange:handleChange,required:!0}),(0,t.jsx)(Input,{label:"% Honoraires",name:"pourcentage_honoraires",value:a.pourcentage_honoraires,onChange:handleChange,readOnly:!0}),(0,t.jsx)(Input,{label:"\uD83D\uDCB0 Prix total affich\xe9 (€)",name:"prix_vente",value:a.prix_vente,onChange:handleChange,readOnly:!0}),(0,t.jsx)(Input,{label:"Taxe fonci\xe8re (€)",name:"taxe_fonciere",value:a.taxe_fonciere,onChange:handleChange}),(0,t.jsx)(Input,{label:"Quote-part annuelle (€)",name:"quote_part_charges",value:a.quote_part_charges,onChange:handleChange}),(0,t.jsx)(Input,{label:"Fonds travaux (€)",name:"fonds_travaux",value:a.fonds_travaux,onChange:handleChange}),(0,t.jsx)(Select,{label:"Type d'offre",name:"type_offre",value:a.type_offre,onChange:handleChange,options:["V","L","S","F","B","W","G"]}),(0,t.jsx)(Input,{label:"Loyer mensuel (€)",name:"loyer_mensuel",value:a.loyer_mensuel,onChange:handleChange}),(0,t.jsx)(Input,{label:"Honoraires location (€)",name:"honoraires_location",value:a.honoraires_location,onChange:handleChange}),(0,t.jsx)(Input,{label:"Bar\xe8me d'honoraires",name:"bareme",value:a.bareme,onChange:handleChange}),(0,t.jsx)(Input,{label:"Altitude (m)",name:"altitude",value:a.altitude,onChange:handleChange}),(0,t.jsxs)("div",{className:"col-span-2 space-x-6",children:[(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",name:"charge_vendeur",checked:a.charge_vendeur,onChange:handleChange,className:"mr-2"}),"Charge vendeur"]}),(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",name:"charge_acquereur",checked:a.charge_acquereur,onChange:handleChange,className:"mr-2"}),"Charge acqu\xe9reur"]})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-orange-500 mb-2",children:"\uD83E\uDDF1 Pi\xe8ces du bien"}),(0,t.jsxs)("div",{className:"flex gap-4 mb-2",children:[(0,t.jsxs)("select",{value:p.nom,onChange:e=>x({...p,nom:e.target.value}),className:"input w-full",children:[(0,t.jsx)("option",{value:"",children:"-- S\xe9lectionner une pi\xe8ce --"}),["Salon","Salle \xe0 manger","Cuisine","Chambre","Salle de bain","Salle d'eau","WC","Bureau","Buanderie","Dressing","Garage","Cave","Grenier","Terrasse","Balcon","V\xe9randa","Autre"].map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),"Autre"===p.nom&&(0,t.jsx)("input",{type:"text",placeholder:"Nom personnalis\xe9",value:p.nomCustom||"",onChange:e=>x({...p,nomCustom:e.target.value}),className:"input w-full"}),(0,t.jsx)("input",{value:p.surface,onChange:e=>x({...p,surface:e.target.value}),placeholder:"Surface en m\xb2",className:"input w-1/3"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e="Autre"===p.nom?p.nomCustom:p.nom;e&&p.surface&&(h([...d,{nom:e,surface:p.surface}]),x({nom:"",nomCustom:"",surface:""}))},className:"bg-orange-600 text-white px-4 rounded",children:"➕ Ajouter"})]}),d.length>0&&(0,t.jsx)("ul",{className:"space-y-1 text-sm text-gray-700",children:d.map((e,n)=>(0,t.jsxs)("li",{children:["• ",e.nom," - ",e.surface," m\xb2"]},n))})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block font-medium mb-1",children:"Description"}),(0,t.jsx)("textarea",{name:"description",value:a.description,onChange:handleChange,rows:6,className:"w-full border border-gray-300 rounded px-3 py-2"}),(0,t.jsx)("button",{type:"button",onClick:handleGenerateDescription,disabled:m,className:"mt-2 bg-blue-600 text-white text-sm px-4 py-1 rounded hover:bg-blue-700",children:m?"✍️ R\xe9daction en cours...":"\uD83E\uDE84 G\xe9n\xe9rer avec l'IA"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Cette phrase est obligatoire : ",(0,t.jsx)("br",{}),(0,t.jsxs)("em",{children:["Les informations sur les risques auxquels ce bien est expos\xe9 sont disponibles sur le site ",(0,t.jsx)("a",{href:"https://www.georisques.gouv.fr",target:"_blank",rel:"noopener noreferrer",className:"text-orange-600 underline",children:"G\xe9orisques"}),"."]})]})]}),(0,t.jsxs)("div",{className:"col-span-2 flex justify-between mt-6",children:[(0,t.jsx)(i(),{href:"/biens/ajouter/etape1?id=".concat(n),className:"text-sm text-orange-600 hover:underline",children:"⬅️ Retour \xe9tape 1"}),(0,t.jsx)("button",{type:"submit",className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded font-semibold",children:"➡️ \xc9tape suivante"})]})]})]})}function Input(e){let{label:n,name:a,value:r,onChange:s,required:l=!1,readOnly:o=!1}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium text-sm mb-1",children:n}),(0,t.jsx)("input",{name:a,value:r,onChange:s,required:l,readOnly:o,className:"w-full border border-gray-300 rounded px-3 py-2 ".concat(o?"bg-gray-100":""),type:"text"})]})}function Select(e){let{label:n,name:a,value:r,onChange:s,options:l}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium text-sm mb-1",children:n}),(0,t.jsx)("select",{name:a,value:r,onChange:s,className:"w-full border border-gray-300 rounded px-3 py-2",children:l.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})}}},function(e){e.O(0,[1664,9774,2888,179],function(){return e(e.s=8156)}),_N_E=e.O()}]);