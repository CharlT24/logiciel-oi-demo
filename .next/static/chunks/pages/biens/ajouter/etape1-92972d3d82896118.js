(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2925],{1053:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/ajouter/etape1",function(){return t(1603)}])},1603:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return Etape1}});var a=t(5893),s=t(7294),n=t(1163),i=t(9846);function Etape1(){let e=(0,n.useRouter)(),[l,t]=(0,s.useState)(null),[o,c]=(0,s.useState)(!0),[d,r]=(0,s.useState)("V"),[u,p]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[m,v]=(0,s.useState)(""),[g,j]=(0,s.useState)(""),[f,b]=(0,s.useState)("Disponible"),[y,N]=(0,s.useState)(""),[_,S]=(0,s.useState)(""),[w,C]=(0,s.useState)(""),[E,k]=(0,s.useState)([]),[V,D]=(0,s.useState)(!1),[T,B]=(0,s.useState)(!1),[U,O]=(0,s.useState)([]),I="AIzaSyBdUW6LH-WYQDi_SmBW8iSm_nO_Uj8oCuU";(0,s.useEffect)(()=>{let getUser=async()=>{var l;let{data:{session:a}}=await i.O.auth.getSession(),s=null==a?void 0:null===(l=a.user)||void 0===l?void 0:l.id;s?(t(s),c(!1)):e.push("/login")};getUser();let fetchTypes=async()=>{let{data:e,error:l}=await i.O.from("types_ubiflow").select("*").order("label",{ascending:!0});l||O(e)};fetchTypes()},[]);let handleVilleInput=async e=>{let l=e.target.value;if(N(l),l.length>2){let e="https://maps.googleapis.com/maps/api/place/autocomplete/json?input=".concat(l,"&types=(cities)&key=").concat(I,"&language=fr"),t=await fetch("/api/proxy?url=".concat(encodeURIComponent(e))),a=await t.json();k(a.predictions||[])}else k([])},handleVilleSelect=async e=>{var l,t,a,s,n,i;N(e.description),k([]);let o="https://maps.googleapis.com/maps/api/place/details/json?place_id=".concat(e.place_id,"&key=").concat(I,"&language=fr"),c=await fetch("/api/proxy?url=".concat(encodeURIComponent(o))),d=await c.json(),r=null==d?void 0:null===(t=d.result)||void 0===t?void 0:null===(l=t.geometry)||void 0===l?void 0:l.location;if((null==r?void 0:r.lat)&&(null==r?void 0:r.lng)){let e="https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(r.lat,",").concat(r.lng,"&key=").concat(I,"&language=fr"),l=await fetch("/api/proxy?url=".concat(encodeURIComponent(e))),t=await l.json(),o=(null==t?void 0:null===(s=t.results)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:a.address_components)||[],c=null===(n=o.find(e=>e.types.includes("postal_code")))||void 0===n?void 0:n.long_name,d=null===(i=o.find(e=>e.types.includes("administrative_area_level_1")))||void 0===i?void 0:i.long_name;c&&S(c),d&&p(d)}},handleSubmit=async()=>{if(!l)return alert("Chargement utilisateur en cours…");let t=U.find(e=>e.label===m),a=(null==t?void 0:t.code)||"1000",{data:s,error:n}=await i.O.from("biens").insert([{titre:h,type_bien:m,code_type_ubiflow:a,mandat:g,statut:f,ville:y,code_postal:_,adresse_bien:w,vente:V,location:T,agent_id:l,type_offre:d,region:u,pays:"France"}]).select();if(n)return alert("Erreur \xe0 l’enregistrement");await i.O.rpc("recalcul_rapprochements"),e.push("/biens/ajouter/etape2?id=".concat(s[0].id))};return o?(0,a.jsx)("p",{className:"text-center mt-10",children:"Chargement..."}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-8 mt-10 rounded-xl shadow space-y-8 border",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-orange-600",children:"\uD83D\uDCDD \xc9tape 1 : Localisation & Type de Bien"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Adresse du Bien"}),(0,a.jsx)("input",{type:"text",className:"input",value:w,onChange:e=>C(e.target.value),placeholder:"Ex: 123 rue de Paris"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Ville"}),(0,a.jsx)("input",{type:"text",className:"input",value:y,onChange:handleVilleInput,placeholder:"Ex: Marseille"}),E.length>0&&(0,a.jsx)("ul",{className:"absolute z-10 bg-white border shadow-md rounded w-full mt-1 text-sm",children:E.map(e=>(0,a.jsx)("li",{onClick:()=>handleVilleSelect(e),className:"px-3 py-2 hover:bg-orange-50 cursor-pointer",children:e.description},e.place_id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Code Postal"}),(0,a.jsx)("input",{type:"text",className:"input",value:_,onChange:e=>S(e.target.value),placeholder:"Ex: 13000"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Titre du Bien"}),(0,a.jsx)("input",{type:"text",className:"input",value:h,onChange:e=>x(e.target.value),placeholder:"Ex: Maison avec jardin"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Type de Bien"}),(0,a.jsxs)("select",{className:"input",value:m,onChange:e=>v(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- S\xe9lectionner --"}),U.map(e=>(0,a.jsx)("option",{value:e.label,children:e.label},e.code))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Type de Mandat"}),(0,a.jsxs)("select",{className:"input",value:g,onChange:e=>j(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"-- Choisir --"}),(0,a.jsx)("option",{value:"Exclusif",children:"Exclusif"}),(0,a.jsx)("option",{value:"Simple",children:"Simple"}),(0,a.jsx)("option",{value:"Mandat de recherche",children:"Mandat de recherche"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Statut du Bien"}),(0,a.jsx)("select",{className:"input",value:"Disponible",disabled:!0,children:(0,a.jsx)("option",{value:"Disponible",children:"Disponible"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"Type d'offre"}),(0,a.jsxs)("select",{className:"input",value:d,onChange:e=>r(e.target.value),children:[(0,a.jsx)("option",{value:"V",children:"Vente"}),(0,a.jsx)("option",{value:"L",children:"Location"}),(0,a.jsx)("option",{value:"F",children:"Fonds de commerce"}),(0,a.jsx)("option",{value:"B",children:"Cession de bail"}),(0,a.jsx)("option",{value:"W",children:"Viager"}),(0,a.jsx)("option",{value:"G",children:"Vente neuf"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-semibold",children:"R\xe9gion"}),(0,a.jsx)("input",{type:"text",className:"input",value:u,onChange:e=>p(e.target.value),placeholder:"Ex: Provence-Alpes-C\xf4te d’Azur"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 flex gap-6 items-center",children:[(0,a.jsxs)("label",{className:"inline-flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:V,onChange:e=>D(e.target.checked),className:"mr-2"})," Vente"]}),(0,a.jsxs)("label",{className:"inline-flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:T,onChange:e=>B(e.target.checked),className:"mr-2"})," Location"]})]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-6",children:(0,a.jsx)("button",{onClick:handleSubmit,className:"bg-orange-600 hover:bg-orange-700 text-white font-semibold px-10 py-3 rounded-xl text-lg shadow",children:"✅ Enregistrer et continuer ➔"})})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=1053)}),_N_E=e.O()}]);