(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[54],{9525:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/biens/[id]",function(){return t(6213)}])},6213:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return FicheBien}});var r=t(5893),n=t(1163),a=t(7294),i=t(9846);let l={A:"#00b050",B:"#92d050",C:"#ffff00",D:"#ffc000",E:"#ff6600",F:"#ff0000",G:"#a80000"},getPlageConso=e=>{switch(e){case"A":return"≤ 50";case"B":return"51 \xe0 90";case"C":return"91 \xe0 150";case"D":return"151 \xe0 230";case"E":return"231 \xe0 330";case"F":return"331 \xe0 450";case"G":return"> 450";default:return""}};var components_DPEBar=e=>{let{lettre:s}=e,t=["A","B","C","D","E","F","G"];return(0,r.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,r.jsx)("div",{className:"flex items-center text-white font-bold text-sm rounded-l-full overflow-hidden ".concat(e===(null==s?void 0:s.toUpperCase())?"ring-2 ring-black":""),children:(0,r.jsxs)("div",{style:{backgroundColor:l[e],width:"".concat(120+15*t.indexOf(e),"px"),padding:"0.3rem 0.6rem"},className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("span",{className:"ml-2 text-white text-xs",children:getPlageConso(e)})]})},e))})};let c={A:"#e7e1ea",B:"#d3bfe5",C:"#be9dde",D:"#a97bd7",E:"#9449cc",F:"#7e33b2",G:"#5d178f"},getPlageGES=e=>{switch(e){case"A":return"≤ 5";case"B":return"6 \xe0 10";case"C":return"11 \xe0 20";case"D":return"21 \xe0 35";case"E":return"36 \xe0 55";case"F":return"56 \xe0 80";case"G":return"> 80";default:return""}};var components_GESBar=e=>{let{lettre:s}=e,t=["A","B","C","D","E","F","G"];return(0,r.jsx)("div",{className:"space-y-1",children:t.map(e=>(0,r.jsx)("div",{className:"flex items-center text-white font-bold text-sm rounded-l-full overflow-hidden ".concat(e===(null==s?void 0:s.toUpperCase())?"ring-2 ring-black":""),children:(0,r.jsxs)("div",{style:{backgroundColor:c[e],width:"".concat(120+15*t.indexOf(e),"px"),padding:"0.3rem 0.6rem"},className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:e}),(0,r.jsx)("span",{className:"ml-2 text-white text-xs",children:getPlageGES(e)})]})},e))})};function FicheBien(){var e,s,t,l,c,d,o;let x=(0,n.useRouter)(),{id:u}=x.query,[h,m]=(0,a.useState)(null),[p,g]=(0,a.useState)([]),[f,D]=(0,a.useState)(null),[_,j]=(0,a.useState)([]),[v,b]=(0,a.useState)(!0),[C,N]=(0,a.useState)(null),[w,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{u&&(fetchBien(),fetchPhotos(),fetchProprietaires(),fetchAgentId())},[u]);let fetchBien=async()=>{let{data:e,error:s}=await i.O.from("biens").select("*").eq("id",u).single();if(s){console.error("Erreur chargement bien:",s);return}if(m(e),null==e?void 0:e.agent_id){let{data:s,error:t}=await i.O.from("utilisateurs").select("prenom, nom").eq("id",e.agent_id).single();!t&&s&&y(s)}b(!1)},fetchProprietaires=async()=>{let{data:e}=await i.O.from("proprietaires").select("*").eq("bien_id",u);e&&g(e)},fetchPhotos=async()=>{let{data:e}=i.O.storage.from("photos").getPublicUrl("covers/".concat(u,"/cover.jpg"));D(e.publicUrl);let{data:s}=await i.O.storage.from("photos").list("gallery/".concat(u));if(null==s?void 0:s.length){let e=s.map(e=>i.O.storage.from("photos").getPublicUrl("gallery/".concat(u,"/").concat(e.name)).data.publicUrl);j(e)}},fetchAgentId=async()=>{var e;let{data:{session:s}}=await i.O.auth.getSession();N((null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.id)||null)},genererMandat=async()=>{let e=confirm("G\xe9n\xe9rer un num\xe9ro de mandat pour ce bien ?");if(e)try{let e=await fetch("/api/mandats/generer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bien_id:h.id,agent_id:h.agent_id||null,bien_info:{ville:h.ville||"",code_postal:h.code_postal||"",type_bien:h.type_bien||"",adresse_bien:h.adresse_bien||""},proprietaire_info:{nom:h.proprietaire_nom||"",prenom:h.proprietaire_prenom||"",adresse_principale:h.adresse_proprietaire||""}})}),s=await e.json();if(!e.ok||!s.success){alert(s.message||"Erreur serveur lors de la g\xe9n\xe9ration du mandat");return}alert("Mandat g\xe9n\xe9r\xe9 : ".concat(s.numero_mandat)),await new Promise(e=>setTimeout(e,1e3)),await fetchBien()}catch(e){console.error("Erreur JS :",e),alert("Erreur inattendue lors de la g\xe9n\xe9ration du mandat")}};return v||!h?(0,r.jsx)("p",{className:"text-center mt-10",children:"Chargement..."}):(null==h?void 0:null===(e=h.statut)||void 0===e?void 0:e.toLowerCase())==="archiv\xe9"?(0,r.jsx)("p",{className:"text-center mt-10 text-red-600",children:"Ce bien est archiv\xe9."}):(0,r.jsxs)("div",{className:"max-w-6xl mx-auto p-6 space-y-10",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:()=>x.push("/biens"),className:"text-orange-600 text-sm hover:underline",children:"⬅️ Retour"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("a",{href:"/api/pdf/vitrine?id=".concat(u),target:"_blank",className:"text-sm bg-orange-100 px-4 py-2 rounded shadow hover:bg-orange-200",children:"\uD83D\uDCC4 Fiche Vitrine PDF"}),(0,r.jsx)("a",{href:"/api/pdf/prive?id=".concat(u),target:"_blank",className:"text-sm bg-gray-100 px-4 py-2 rounded shadow hover:bg-gray-200",children:"\uD83D\uDD12 Fiche Priv\xe9e PDF"})]})]}),(0,r.jsxs)("h1",{className:"text-3xl font-bold text-orange-600",children:["\uD83C\uDFE1 ",h.titre]}),w&&(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Saisi par : ",(0,r.jsxs)("strong",{children:[w.prenom," ",w.nom]})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[h.ville," (",h.code_postal,")"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Mandat : ",h.mandat||"N/A"," – Statut : ",h.statut]}),(null===(s=h.statut)||void 0===s?void 0:s.toLowerCase())==="estimation"&&(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("button",{onClick:genererMandat,className:"bg-orange-500 hover:bg-orange-600 text-white px-5 py-2 rounded-xl",children:"\uD83D\uDCC4 G\xe9n\xe9rer un mandat"})}),f&&(0,r.jsx)("img",{src:f,alt:"photo",className:"w-full rounded-xl shadow-xl h-96 object-cover"}),_.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-lg font-semibold text-orange-500 mt-6 mb-2",children:["\uD83D\uDCF8 Galerie (",_.length," photos)"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:_.map((e,s)=>(0,r.jsx)("img",{src:e,className:"rounded-lg shadow h-40 object-cover"},s))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6 text-sm",children:[(0,r.jsxs)("p",{children:["\uD83D\uDCD0 Surface : ",(0,r.jsxs)("strong",{children:[h.surface_m2," m\xb2"]})]}),(0,r.jsxs)("p",{children:["\uD83D\uDECF️ Chambres : ",(0,r.jsx)("strong",{children:h.nb_chambres})]}),(0,r.jsxs)("p",{children:["\uD83D\uDECB️ Pi\xe8ces : ",(0,r.jsx)("strong",{children:h.nb_pieces})]}),(0,r.jsxs)("p",{children:["\uD83C\uDFE2 \xc9tage : ",(0,r.jsx)("strong",{children:h.etage})]}),(0,r.jsxs)("p",{children:["\uD83C\uDFF7️ Type : ",(0,r.jsx)("strong",{children:h.type_bien})]}),(0,r.jsxs)("p",{children:["\uD83C\uDFD7️ Ann\xe9e : ",(0,r.jsx)("strong",{children:h.annee_construction})]}),(0,r.jsxs)("p",{children:["\uD83D\uDD25 Chauffage : ",(0,r.jsxs)("strong",{children:[h.type_chauffage," (",h.mode_chauffage,")"]})]}),(0,r.jsxs)("p",{children:["\uD83C\uDF0D Terrain : ",(0,r.jsxs)("strong",{children:[h.surface_terrain," m\xb2"]})]}),(0,r.jsxs)("p",{children:["\uD83D\uDCD0 Carrez : ",(0,r.jsxs)("strong",{children:[h.surface_carrez," m\xb2"]})]})]}),(null===(t=h.options)||void 0===t?void 0:t.length)>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-orange-500",children:"⚙️ Options & Caract\xe9ristiques"}),(0,r.jsx)("ul",{className:"flex flex-wrap gap-2 text-sm mt-2",children:h.options.map((e,s)=>(0,r.jsx)("li",{className:"bg-orange-100 px-3 py-1 rounded-full shadow text-gray-700",children:e},s))})]}),(0,r.jsxs)("div",{className:"bg-orange-50 p-4 rounded shadow text-sm",children:[h.charge_acquereur?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["\uD83D\uDCB0 Prix affich\xe9 (hors honoraires) : ",(0,r.jsxs)("strong",{children:[null===(l=h.prix_net_vendeur)||void 0===l?void 0:l.toLocaleString()," €"]})]}),(0,r.jsxs)("p",{children:["➕ Honoraires : ",null===(c=h.honoraires)||void 0===c?void 0:c.toLocaleString()," €"]}),(0,r.jsxs)("p",{children:["\uD83D\uDCCA % Honoraires : ",h.pourcentage_honoraires,"%"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["\uD83D\uDCB0 Prix affich\xe9 (FAI) : ",(0,r.jsxs)("strong",{children:[null===(d=h.prix_vente)||void 0===d?void 0:d.toLocaleString()," €"]})]}),(0,r.jsx)("p",{className:"text-gray-400 italic",children:"Honoraires \xe0 la charge du vendeur"})]}),h.taxe_fonciere&&(0,r.jsxs)("p",{children:["\uD83D\uDCDC Taxe fonci\xe8re : ",h.taxe_fonciere," €"]}),h.quote_part_charges&&(0,r.jsxs)("p",{children:["\uD83D\uDCBC Charges annuelles : ",h.quote_part_charges," €"]}),h.fonds_travaux&&(0,r.jsxs)("p",{children:["\uD83C\uDFDB️ Fonds travaux : ",h.fonds_travaux," €"]})]}),(h.dpe_etiquette_conso||h.dpe||h.dpe_vierge)&&(0,r.jsxs)("div",{className:"mt-10",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-orange-500",children:"\uD83D\uDD0D Diagnostic \xc9nerg\xe9tique (DPE)"}),h.dpe_vierge?(0,r.jsx)("p",{className:"text-sm mt-2 text-gray-600",children:"DPE vierge (non soumis)"}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mt-4 items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-sm text-gray-600 mb-1",children:"Consommation d’\xe9nergie"}),(0,r.jsx)(components_DPEBar,{lettre:h.dpe_etiquette_conso||h.dpe||"-"}),h.dpe_conso_indice&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["⚡ ",h.dpe_conso_indice," kWh/m\xb2/an"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-sm text-gray-600 mb-1",children:"\xc9missions de GES"}),(0,r.jsx)(components_GESBar,{lettre:h.dpe_etiquette_ges||(null==(o=h.dpe_ges_indice)?"":o<=5?"A":o<=10?"B":o<=20?"C":o<=35?"D":o<=55?"E":o<=80?"F":"G")}),h.dpe_ges_indice&&(0,r.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["\uD83C\uDF2B️ ",h.dpe_ges_indice," kgCO₂/m\xb2/an"]})]}),(0,r.jsxs)("div",{className:"col-span-2 space-y-1 text-sm mt-4",children:[h.dpe_date_realisation&&(0,r.jsxs)("p",{children:["\uD83D\uDCC5 R\xe9alis\xe9 le : ",h.dpe_date_realisation]}),(h.montant_depenses_energies_min||h.montant_depenses_energies_max)&&(0,r.jsxs)("p",{children:["\uD83D\uDCB6 Estimation : ",h.montant_depenses_energies_min||"?"," € – ",h.montant_depenses_energies_max||"?"," €"]}),h.energie_finale_kwh&&(0,r.jsxs)("p",{children:["\uD83D\uDD25 \xc9nergie finale : ",h.energie_finale_kwh," kWh/m\xb2/an"]})]})]})]}),h.description&&(0,r.jsxs)("div",{className:"mt-10",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-orange-500",children:"\uD83D\uDCDD Description"}),(0,r.jsxs)("p",{className:"text-sm text-gray-700 whitespace-pre-line mt-2",children:[h.description,"\n\n","\uD83D\uDD0D Infos risques :"," ",(0,r.jsx)("a",{href:"https://www.georisques.gouv.fr",className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"G\xe9orisques"})]})]}),p.length>0&&(0,r.jsxs)("div",{className:"mt-10",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-orange-500",children:"\uD83D\uDC64 Propri\xe9taires"}),(0,r.jsx)("div",{className:"space-y-3 text-sm",children:p.map((e,s)=>(0,r.jsxs)("div",{className:"bg-gray-50 border p-4 rounded shadow",children:[(0,r.jsx)("p",{children:(0,r.jsxs)("strong",{children:[e.prenom," ",e.nom]})}),(0,r.jsxs)("p",{children:["Email : ",e.email]}),(0,r.jsxs)("p",{children:["T\xe9l\xe9phone : ",e.telephone]}),(0,r.jsxs)("p",{children:["Adresse : ",e.adresse_principale]}),e.adresse_differente&&(0,r.jsxs)("p",{children:["Adresse 2 : ",e.adresse_differente]}),(0,r.jsxs)("p",{children:["Mandat #",e.numero_mandat," – du ",e.date_debut_mandat," au ",e.date_fin_mandat]})]},s))})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-orange-500 mb-2",children:"\uD83D\uDCCD Localisation"}),(0,r.jsx)("iframe",{src:"https://www.google.com/maps/embed/v1/place?key=".concat("***REMOVED_FOR_PUSH***","&q=").concat(encodeURIComponent(h.ville+", "+h.code_postal)),width:"100%",height:"350",className:"rounded-xl shadow",loading:"lazy"})]})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=9525)}),_N_E=e.O()}]);