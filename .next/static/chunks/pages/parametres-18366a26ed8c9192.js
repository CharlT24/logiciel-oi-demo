(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4112],{8652:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/parametres",function(){return l(5274)}])},5274:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return Parametres}});var n=l(5893),t=l(7294),r=l(1163),o=l(9846);function Parametres(){let[e,a]=(0,t.useState)(null),[l,s]=(0,t.useState)({nom:"",prenom:"",telephone:"",email_contact:"",url_bareme:"",pays:"",ville:"",code_postal:"",adresse:"",siret:"",rsac:"",photo_url:""}),u=(0,r.useRouter)();(0,t.useEffect)(()=>{let getUser=async()=>{var e,l,n;let t=await o.O.auth.getSession(),r=null==t?void 0:null===(n=t.data)||void 0===n?void 0:null===(l=n.session)||void 0===l?void 0:null===(e=l.user)||void 0===e?void 0:e.id;if(!r)return u.push("/login");a(r),fetchInfos(r)};getUser()},[]);let fetchInfos=async e=>{let{data:a,error:l}=await o.O.from("utilisateurs").select("*").eq("id",e).single();!l&&a&&s({nom:a.nom||"",prenom:a.prenom||"",telephone:a.telephone||"",email_contact:a.email_contact||"",url_bareme:a.url_bareme||"",pays:a.pays||"",ville:a.ville||"",code_postal:a.code_postal||"",adresse:a.adresse||"",siret:a.siret||"",rsac:a.rsac||"",photo_url:a.photo_url||""})},handleChange=e=>{let{name:a,value:l}=e.target;s(e=>({...e,[a]:l}))},handlePhotoUpload=async a=>{let l=a.target.files[0];if(!l||!e)return;let n=l.name.split(".").pop(),t="".concat(e,".").concat(n),r="avatars/".concat(t),{error:u}=await o.O.storage.from("photos").upload(r,l,{upsert:!0});if(u)return console.error("❌ Erreur upload Supabase :",u),alert("Erreur lors de l'upload de la photo.");let{data:i}=o.O.storage.from("photos").getPublicUrl(r),d=null==i?void 0:i.publicUrl,{error:c}=await o.O.from("utilisateurs").update({photo_url:d}).eq("id",e);if(c)return console.error("❌ Erreur mise \xe0 jour Supabase :",c),alert("Photo upload\xe9e mais non enregistr\xe9e.");s(e=>({...e,photo_url:d})),alert("✅ Photo mise \xe0 jour avec succ\xe8s !")},handleSubmit=async a=>{a.preventDefault();let{error:n}=await o.O.from("utilisateurs").update(l).eq("id",e);n?(console.error("❌ Erreur mise \xe0 jour :",n),alert("Erreur lors de la mise \xe0 jour.")):(alert("✅ Profil mis \xe0 jour avec succ\xe8s"),u.push("/dashboard"))};return(0,n.jsxs)("div",{className:"max-w-4xl mx-auto bg-white shadow rounded-xl p-8 mt-8 space-y-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-orange-700",children:"⚙️ Param\xe8tres du compte"}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[l.photo_url?(0,n.jsx)("img",{src:l.photo_url,alt:"avatar",className:"w-20 h-20 rounded-full object-cover border"}):(0,n.jsx)("div",{className:"w-20 h-20 rounded-full bg-orange-100 flex items-center justify-center text-orange-500 font-bold text-lg border",children:"?"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block mb-1 font-medium text-sm",children:"Photo de profil"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:handlePhotoUpload,className:"text-sm"})]})]}),(0,n.jsxs)("form",{onSubmit:handleSubmit,className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-700",children:[(0,n.jsx)(Input,{label:"Nom",name:"nom",value:l.nom,onChange:handleChange}),(0,n.jsx)(Input,{label:"Pr\xe9nom",name:"prenom",value:l.prenom,onChange:handleChange}),(0,n.jsx)(Input,{label:"T\xe9l\xe9phone",name:"telephone",value:l.telephone,onChange:handleChange}),(0,n.jsx)(Input,{label:"Email de contact",name:"email_contact",value:l.email_contact,onChange:handleChange}),(0,n.jsx)(Input,{label:"URL bar\xe8me honoraires",name:"url_bareme",value:l.url_bareme,onChange:handleChange}),(0,n.jsx)(Input,{label:"Pays",name:"pays",value:l.pays,onChange:handleChange}),(0,n.jsx)(Input,{label:"Ville",name:"ville",value:l.ville,onChange:handleChange}),(0,n.jsx)(Input,{label:"Code postal",name:"code_postal",value:l.code_postal,onChange:handleChange}),(0,n.jsx)(Input,{label:"Adresse",name:"adresse",value:l.adresse,onChange:handleChange}),(0,n.jsx)(Input,{label:"SIRET",name:"siret",value:l.siret,onChange:handleChange}),(0,n.jsx)(Input,{label:"Num\xe9ro RSAC",name:"rsac",value:l.rsac,onChange:handleChange}),(0,n.jsx)("div",{className:"col-span-full text-right",children:(0,n.jsx)("button",{type:"submit",className:"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded shadow",children:"\uD83D\uDCBE Enregistrer mes modifications"})})]})]})}function Input(e){let{label:a,name:l,value:t,onChange:r}=e;return(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("label",{htmlFor:l,className:"mb-1 font-medium",children:a}),(0,n.jsx)("input",{id:l,name:l,value:t,onChange:r,className:"border border-gray-300 rounded px-3 py-2"})]})}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=8652)}),_N_E=e.O()}]);