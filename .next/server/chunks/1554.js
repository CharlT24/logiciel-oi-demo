"use strict";exports.id=1554,exports.ids=[1554],exports.modules={2516:(e,t,o)=>{o.d(t,{X:()=>generateUbiflowXML});var r=o(3267);let n={"Bien immobilier":"0","Bien habitation (particuliers)":"1000",Appartement:"1100","Appartement ancien":"1111","Appartement bourgeois":"1112","Appartement \xe0 r\xe9nover":"1113","Appartement r\xe9nov\xe9":"1114","Appartement r\xe9cent":"1115","Appartement neuf":"1116",Chambre:"1131",Studio:"1132",T1:"1133","T1 bis":"1134",T2:"1135",T3:"1136",T4:"1137",T5:"1138","T6 et plus":"1139","Habitation de loisirs":"1180",Autre:"1190",Loft:"1191","Duplex/Triplex":"1192",MeublÃ©:"1193",Penthouse:"1194",Maison:"1200","Bien d'entreprise ou commerce (professionnels)":"2000"},i=[{keywords:["appartement ancien"],code:"1111"},{keywords:["appartement bourgeois"],code:"1112"},{keywords:["appartement \xe0 r\xe9nover","\xe0 r\xe9nover"],code:"1113"},{keywords:["appartement r\xe9nov\xe9"],code:"1114"},{keywords:["appartement r\xe9cent","appartement contemporain"],code:"1115"},{keywords:["appartement neuf"],code:"1116"},{keywords:["chambre \xe9tudiant"],code:"1131"},{keywords:["studio"],code:"1132"},{keywords:["t1","type 1","f1"],code:"1133"},{keywords:["t1 bis","type 1 bis","f1 bis"],code:"1134"},{keywords:["t2","type 2","f2"],code:"1135"},{keywords:["t3","type 3","f3"],code:"1136"},{keywords:["t4","type 4","f4"],code:"1137"},{keywords:["t5","type 5","f5"],code:"1138"},{keywords:["t6","t7","t8","type 6","type 7","type 8","f6","f7","f8"],code:"1139"},{keywords:["loft"],code:"1191"},{keywords:["duplex","triplex"],code:"1192"},{keywords:["meubl\xe9"],code:"1193"},{keywords:["penthouse"],code:"1194"},{keywords:["maison"],code:"1200"},{keywords:["villa"],code:"1213"},{keywords:["terrain"],code:"1300"},{keywords:["parking","garage","stationnement"],code:"1400"},{keywords:["immeuble"],code:"1500"},{keywords:["local","commerce","bureau","entreprise"],code:"2000"}];function generateUbiflowXML(e){try{let t=(0,r.create)({version:"1.0",encoding:"UTF-8"}).ele("client",{reference:"OI123"});for(let o of e){let e=t.ele("annonce"),r=String(o.type_offre||"V").toUpperCase().trim();["V","L","F","B","W","G"].includes(r)||(console.warn(`âš ï¸ type_offre invalide pour le bien ${o.id} (${o.titre})`),r="V");let a=`OI-${(o.id||"").slice(0,8)}`;e.ele("reference").txt(a),e.ele("titre").txt(o.titre||""),e.ele("texte").txt(o.description||"Description disponible en agence.");let s=function(e,t=""){let o=`${e} ${t}`.toLowerCase();for(let{keywords:e,code:t}of i)if(e.some(e=>o.includes(e)))return t;let r=Object.entries(n).find(([e])=>o.includes(e.toLowerCase()));return r?r[1]:"1000"}(o.type_bien||"",o.description||"");e.ele("code_type").txt(s),e.ele("type_offre").txt(r),e.ele("contact_a_afficher").txt(o.agent?.nom||""),e.ele("email_a_afficher").txt(o.agent?.email||""),e.ele("telephone_a_afficher").txt(o.agent?.telephone||"");let l=e.ele("photos"),c=`https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/covers/${o.id}/cover.jpg`;l.ele("photo",{ordre:"1"}).txt(c),Array.isArray(o.gallery)&&o.gallery.forEach((e,t)=>{let r=`https://fkavtsofmglifzalclyn.supabase.co/storage/v1/object/public/photos/gallery/${o.id}/${e}`;l.ele("photo",{ordre:`${t+2}`}).txt(r)});let p=String(o.code_postal).trim(),d=String(o.ville).trim(),u=d.split(",")[0].replace(/France/gi,"").trim(),_=e.ele("bien");_.ele("type").txt(s),_.ele("libelle_type").txt(o.type_bien||""),_.ele("code_postal").txt(p),_.ele("ville").txt(u),_.ele("nb_pieces_logement").txt(o.nb_pieces||""),_.ele("nombre_de_chambres").txt(o.nb_chambres||""),_.ele("surface").txt(o.surface_m2||""),_.ele("surface_sejour").txt(""),_.ele("surface_terrain").txt(o.surface_terrain||""),_.ele("annee_construction").txt(o.annee_construction||"");let m=e.ele("diagnostiques");m.ele("dpe_etiquette_conso").txt(o.dpe||""),m.ele("dpe_valeur_conso").txt(o.dpe_conso_indice||""),m.ele("dpe_etiquette_ges").txt(o.dpe_etiquette_ges||"");let x=parseFloat(o.dpe_ges_indice);m.ele("dpe_valeur_ges").txt(x>0?x.toString():""),m.ele("dpe_date_realisation").txt(o.dpe_date_realisation||""),m.ele("montant_depenses_energies_min").txt(o.montant_depenses_energies_min||""),m.ele("montant_depenses_energies_max").txt(o.montant_depenses_energies_max||""),m.ele("montant_depense_energie_estime").txt(o.montant_depense_energie_estime||""),m.ele("date_indice_prix_energies").txt(o.date_indice_prix_energies||""),m.ele("altitude").txt(o.altitude||"");let f=e.ele("prestation");f.ele("type").txt(r),["V","W","F","B","G"].includes(r)&&(o.honoraires&&f.ele("honoraires").txt(o.honoraires),f.ele("honoraires_payeurs").txt(o.charge_honoraires||"Vendeur"),o.bareme&&f.ele("bareme").txt(o.bareme)),"L"===r&&(o.loyer_mensuel&&f.ele("loyer_mensuel").txt(o.loyer_mensuel),o.honoraires_location&&f.ele("honoraires_location").txt(o.honoraires_location),f.ele("honoraires_payeurs").txt(o.charge_honoraires||"Locataire"),o.bareme&&f.ele("bareme").txt(o.bareme));let y=e.ele("contact");y.ele("contact_a_afficher").txt(o.agent?.nom||""),y.ele("email_a_afficher").txt(o.agent?.email||""),y.ele("telephone_a_afficher").txt(o.agent?.telephone||"")}return t.end({prettyPrint:!0})}catch(e){throw console.error("âŒ Erreur pendant la g\xe9n\xe9ration du XML :",e),e}}},9030:(e,t,o)=>{o.d(t,{a:()=>pushToFtp});var r=o(4483),n=o(2781);async function pushToFtp({host:e,user:t,password:o,destination:i,fileName:a,content:s}){let l=new r.Client;try{console.log("\uD83D\uDD10 Connexion FTP en cours..."),await l.access({host:e,user:t,password:o}),console.log(`âœ… Connect\xe9 \xe0 ${e} en tant que ${t}`);let r=i?.replace(/^\/+|\/+$/g,"")||"",c=r?`${r}/${a}`:a;console.log(`ðŸ“ Dossier de destination : ${r||"(racine)"}`),console.log(`ðŸ“„ Nom du fichier : ${a}`),r&&(console.log(`ðŸ“‚ V\xe9rification/Cr\xe9ation du dossier ${r}...`),await l.ensureDir(r),console.log("âœ… Dossier pr\xeat"));let p=n.Readable.from([s]);return console.log("\uD83D\uDE80 Envoi du fichier..."),await l.uploadFrom(p,c),console.log(`âœ… FTP upload termin\xe9 : ${c}`),{success:!0}}catch(e){return console.error("âŒ FTP Error:",e),{success:!1,error:e.message}}finally{l.close(),console.log("\uD83D\uDD0C Connexion FTP ferm\xe9e")}}},2678:(e,t,o)=>{o.d(t,{O:()=>n});var r=o(2885);let n=globalThis.supabase||(0,r.createClient)("https://fkavtsofmglifzalclyn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrYXZ0c29mbWdsaWZ6YWxjbHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5MDgzNDIsImV4cCI6MjA1ODQ4NDM0Mn0.vN8-2RzyVu_2X4lWT4Uqa6aI3OYuAcIFFuMeGS5Po1Y")}};